{"ast":null,"code":"!function (e, t) {\n  \"object\" == typeof exports && \"object\" == typeof module ? module.exports = t() : \"function\" == typeof define && define.amd ? define([], t) : \"object\" == typeof exports ? exports.cqSpaPageModelManager = t() : e.cqSpaPageModelManager = t();\n}(\"undefined\" != typeof self ? self : this, function () {\n  return function (e) {\n    var t = {};\n\n    function n(r) {\n      if (t[r]) return t[r].exports;\n      var a = t[r] = {\n        i: r,\n        l: !1,\n        exports: {}\n      };\n      return e[r].call(a.exports, a, a.exports, n), a.l = !0, a.exports;\n    }\n\n    return n.m = e, n.c = t, n.d = function (e, t, r) {\n      n.o(e, t) || Object.defineProperty(e, t, {\n        enumerable: !0,\n        get: r\n      });\n    }, n.r = function (e) {\n      \"undefined\" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {\n        value: \"Module\"\n      }), Object.defineProperty(e, \"__esModule\", {\n        value: !0\n      });\n    }, n.t = function (e, t) {\n      if (1 & t && (e = n(e)), 8 & t) return e;\n      if (4 & t && \"object\" == typeof e && e && e.__esModule) return e;\n      var r = Object.create(null);\n      if (n.r(r), Object.defineProperty(r, \"default\", {\n        enumerable: !0,\n        value: e\n      }), 2 & t && \"string\" != typeof e) for (var a in e) {\n        n.d(r, a, function (t) {\n          return e[t];\n        }.bind(null, a));\n      }\n      return r;\n    }, n.n = function (e) {\n      var t = e && e.__esModule ? function () {\n        return e[\"default\"];\n      } : function () {\n        return e;\n      };\n      return n.d(t, \"a\", t), t;\n    }, n.o = function (e, t) {\n      return Object.prototype.hasOwnProperty.call(e, t);\n    }, n.p = \"\", n(n.s = 9);\n  }([function (e, t, n) {\n    \"use strict\";\n\n    n.d(t, \"a\", function () {\n      return h;\n    });\n    var r = n(1),\n        a = {\n      DEFAULT_SLING_MODEL_SELECTOR: \"model\",\n      DEFAULT_MODEL_JSON_EXTENSION: \".model.json\"\n    },\n        i = n(3),\n        o = n(7),\n        s = n(8),\n        u = n.n(s);\n\n    function l(e, t) {\n      for (var n = 0; n < t.length; n++) {\n        var r = t[n];\n        r.enumerable = r.enumerable || !1, r.configurable = !0, \"value\" in r && (r.writable = !0), Object.defineProperty(e, r.key, r);\n      }\n    }\n\n    var c = /(?:\\/)(?:content|apps|libs|etc|etc.clientlibs|conf|mnt\\/overlay)(?:\\/)/,\n        f = \"(.+)/\" + r.a.JCR_CONTENT + \"/(.+)\",\n        h = function () {\n      function e() {\n        !function (e, t) {\n          if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\");\n        }(this, e);\n      }\n\n      var t, n, s;\n      return t = e, s = [{\n        key: \"isBrowser\",\n        value: function value() {\n          try {\n            return \"undefined\" != typeof window;\n          } catch (e) {\n            return !1;\n          }\n        }\n      }, {\n        key: \"getContextPath\",\n        value: function value(e) {\n          if (!(e = e || this.getCurrentPathname())) return \"\";\n          var t = e.match(c);\n          return t && t.index > 0 ? e.slice(0, t.index) : \"\";\n        }\n      }, {\n        key: \"adaptPagePath\",\n        value: function value(t, n) {\n          if (!t) return \"\";\n          if (!n) return t;\n          var r = e.internalize(t);\n          return r === e.sanitize(n) ? \"\" : r;\n        }\n      }, {\n        key: \"externalize\",\n        value: function value(e) {\n          var t = this.getContextPath();\n          return e.startsWith(t) ? e : \"\".concat(t).concat(e);\n        }\n      }, {\n        key: \"internalize\",\n        value: function value(e) {\n          if (!e) return e;\n          var t = this.getContextPath();\n          return e.replace(new RegExp(\"^\".concat(t, \"/\")), \"/\");\n        }\n      }, {\n        key: \"getMetaPropertyValue\",\n        value: function value(e) {\n          if (this.isBrowser()) {\n            var t = document.head.querySelector('meta[property=\"' + e + '\"]');\n            return t && t.content;\n          }\n        }\n      }, {\n        key: \"convertToModelUrl\",\n        value: function value(e) {\n          return e && e.replace && e.replace(/\\.htm(l)?$/, a.DEFAULT_MODEL_JSON_EXTENSION);\n        }\n      }, {\n        key: \"getCurrentPageModelUrl\",\n        value: function value() {\n          return this.convertToModelUrl(this.getCurrentPathname());\n        }\n      }, {\n        key: \"getModelUrl\",\n        value: function value(e) {\n          if (e && e.replace) return this.convertToModelUrl(e);\n          var t = this.getMetaPropertyValue(i.a.PAGE_MODEL_ROOT_URL);\n          return t || this.getCurrentPageModelUrl();\n        }\n      }, {\n        key: \"sanitize\",\n        value: function value(e) {\n          if (e) {\n            var t = u.a.parse(e, !1, !0).pathname,\n                n = (t = this.internalize(t)).indexOf(\".\");\n            return n > -1 && (t = t.substr(0, n)), t = Object(o.normalize)(t);\n          }\n        }\n      }, {\n        key: \"addExtension\",\n        value: function value(e, t) {\n          if (!t || t.length < 1) return e;\n          if (t.startsWith(\".\") || (t = \".\" + t), !e || e.length < 1 || e.indexOf(t) > -1) return e;\n          var n = e,\n              r = /^((?:[/a-zA-Z0-9:_-]*)+)(?:\\.?)([a-zA-Z0-9._-]*)(?:\\/?)([a-zA-Z0-9/._-]*)(?:\\??)([a-zA-Z0-9=&]*)$/g.exec(e),\n              a = \"\";\n          return r && r.length > 2 && (a = r[3] ? \"/\" + r[3] : \"\", a += r[4] ? \"?\" + r[4] : \"\", n = r[1] + \".\" + r[2].replace(/\\.htm(l)?/, t) + a), n.indexOf(t) > -1 ? n : n + t + a;\n        }\n      }, {\n        key: \"addSelector\",\n        value: function value(e, t) {\n          if (!t || t.length < 1) return e;\n          if (t.startsWith(\".\") || (t = \".\" + t), !e || e.length < 1 || e.indexOf(t) > -1) return e;\n          var n = e.indexOf(\".\") || e.length;\n          return n < 0 ? e + t : e.slice(0, n) + t + e.slice(n, e.length);\n        }\n      }, {\n        key: \"getCurrentPathname\",\n        value: function value() {\n          return this.isBrowser() ? window.location.pathname : void 0;\n        }\n      }, {\n        key: \"dispatchGlobalCustomEvent\",\n        value: function value(e, t) {\n          this.isBrowser() && window.dispatchEvent(new CustomEvent(e, t));\n        }\n      }, {\n        key: \"join\",\n        value: function value(e) {\n          return e ? this.normalize(e.filter(function (e) {\n            return e;\n          }).join(\"/\")) : \"\";\n        }\n      }, {\n        key: \"normalize\",\n        value: function value(e) {\n          return e && e ? e.replace(/(\\/+)/g, \"/\") : \"\";\n        }\n      }, {\n        key: \"makeAbsolute\",\n        value: function value(e) {\n          return e && \"string\" == typeof e ? e.startsWith(\"/\") ? e : \"/\" + e : \"\";\n        }\n      }, {\n        key: \"makeRelative\",\n        value: function value(e) {\n          return e && \"string\" == typeof e ? e.startsWith(\"/\") ? e.slice(1) : e : \"\";\n        }\n      }, {\n        key: \"getParentNodePath\",\n        value: function value(e) {\n          var t = e.lastIndexOf(\"/\") + 1;\n          return e && \"string\" == typeof e && t > 0 && t < e.length && e.substring(0, t - 1);\n        }\n      }, {\n        key: \"isItem\",\n        value: function value(e) {\n          return new RegExp(f).test(e);\n        }\n      }, {\n        key: \"getNodeName\",\n        value: function value(e) {\n          var t = e.lastIndexOf(\"/\") + 1;\n          return e && \"string\" == typeof e && t < e.length && e.substring(t, e.length);\n        }\n      }, {\n        key: \"subpath\",\n        value: function value(t, n) {\n          if (!t) return \"\";\n          var r,\n              a = e.makeRelative(t).split(\"/\"),\n              i = e.makeRelative(n).split(\"/\");\n          if (a.length < i.length) return t;\n\n          for (r = 0; r < i.length && a[r] === i[r]; ++r) {\n            ;\n          }\n\n          return r === i.length ? a.slice(r).join(\"/\") : t;\n        }\n      }, {\n        key: \"splitByDelimitators\",\n        value: function value(t, n) {\n          var r = [t];\n          return n.forEach(function (t) {\n            var n = [],\n                a = e.normalize(e.makeAbsolute(t) + \"/\");\n            r.forEach(function (r) {\n              if (n = n.concat(r.split(a)), r.endsWith(t)) {\n                var i = n.splice(n.length - 1, 1)[0];\n                i !== t && (n = n.concat(i.split(e.makeAbsolute(t))));\n              }\n\n              n = n.filter(function (e) {\n                return e;\n              });\n            }), r = n;\n          }), r;\n        }\n      }, {\n        key: \"_getJCRPath\",\n        value: function value(e, t) {\n          return e + \"/\" + r.a.JCR_CONTENT + \"/\" + t;\n        }\n      }, {\n        key: \"splitPageContentPaths\",\n        value: function value(e) {\n          if (e || \"string\" == typeof e) {\n            var t = e.split(\"/\" + r.a.JCR_CONTENT + \"/\"),\n                n = {\n              pagePath: t[0]\n            };\n            return t.length > 1 && (n.itemPath = t[1]), n;\n          }\n        }\n      }, {\n        key: \"trimStrings\",\n        value: function value(t, n) {\n          return n.forEach(function (n) {\n            for (; t.startsWith(n);) {\n              t = e.makeRelative(t.slice(n.length));\n            }\n\n            for (; t.endsWith(n);) {\n              (t = t.slice(0, t.length - n.length)).endsWith(\"/\") && (t = t.slice(0, t.length - 1));\n            }\n          }), t;\n        }\n      }, {\n        key: \"_getStartStrings\",\n        value: function value(t, n) {\n          var r = \"\";\n          return n.forEach(function (n) {\n            for (; t.startsWith(n);) {\n              t = e.makeRelative(t.slice(n.length)), r = r + \"/\" + n;\n            }\n          }), e.makeRelative(r);\n        }\n      }], (n = null) && l(t.prototype, n), s && l(t, s), e;\n    }();\n  }, function (e, t, n) {\n    \"use strict\";\n\n    t.a = {\n      TYPE_PROP: \":type\",\n      ITEMS_PROP: \":items\",\n      ITEMS_ORDER_PROP: \":itemsOrder\",\n      PATH_PROP: \":path\",\n      CHILDREN_PROP: \":children\",\n      HIERARCHY_TYPE_PROP: \":hierarchyType\",\n      JCR_CONTENT: \"jcr:content\"\n    };\n  }, function (e, t) {\n    e.exports = require(\"clone\");\n  }, function (e, t, n) {\n    \"use strict\";\n\n    t.a = {\n      PAGE_MODEL_ROOT_URL: \"cq:pagemodel_root_url\",\n      PAGE_MODEL_ROUTE_FILTERS: \"cq:pagemodel_route_filters\",\n      PAGE_MODEL_ROUTER: \"cq:pagemodel_router\"\n    };\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.d(t, \"b\", function () {\n      return g;\n    });\n    var r = n(0),\n        a = n(1),\n        i = n(3),\n        o = n(2),\n        s = n.n(o),\n        u = n(5);\n\n    function l(e, t) {\n      for (var n = 0; n < t.length; n++) {\n        var r = t[n];\n        r.enumerable = r.enumerable || !1, r.configurable = !0, \"value\" in r && (r.writable = !0), Object.defineProperty(e, r.key, r);\n      }\n    }\n\n    function c(e) {\n      r.a.dispatchGlobalCustomEvent(u.a.PAGE_MODEL_LOADED, {\n        detail: {\n          model: s()(e)\n        }\n      });\n    }\n\n    var f = function () {\n      function e(t) {\n        var n = this;\n        !function (e, t) {\n          if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\");\n        }(this, e), this._modelManager = t, this._windowListener = function (e) {\n          e && e.detail && e.detail.msg ? n._updateModel(e.detail.msg) : console.error(\"EditorService.js\", \"No message passed to cq-pagemodel-update\", e);\n        }, r.a.isBrowser() && window.addEventListener(u.a.PAGE_MODEL_UPDATE, this._windowListener);\n      }\n\n      var t, n, a;\n      return t = e, (n = [{\n        key: \"_updateModel\",\n        value: function value(e) {\n          if (e && e.cmd && e.path) {\n            var t,\n                n,\n                a,\n                i = e.path,\n                o = e.cmd,\n                u = s()(e.data);\n\n            switch (o) {\n              case \"replace\":\n                this._modelManager.modelStore.setData(i, u), this._modelManager._notifyListeners(i);\n                break;\n\n              case \"delete\":\n                this._modelManager.modelStore.removeData(i), this._modelManager._notifyListeners(r.a.getParentNodePath(i));\n                break;\n\n              case \"insertBefore\":\n                a = !0;\n\n              case \"insertAfter\":\n                t = r.a.getNodeName(i), n = r.a.getParentNodePath(i) + \"/\" + u.key, this._modelManager._modelStore.insertData(n, u.value, t, a), this._modelManager._notifyListeners(r.a.getParentNodePath(i));\n                break;\n\n              default:\n                console.log(\"EditorClient\", \"unsupported command:\", o);\n            }\n\n            c(this._modelManager.modelStore._data);\n          } else console.error(\"PageModelManager.js\", \"Not enough data received to update the page model\");\n        }\n      }, {\n        key: \"destroy\",\n        value: function value() {\n          this._modelManager = null, delete this._modelManager, r.a.isBrowser() && window.removeEventListener(u.a.PAGE_MODEL_UPDATE, this._windowListener);\n        }\n      }]) && l(t.prototype, n), a && l(t, a), e;\n    }(),\n        h = n(6);\n\n    function d(e, t) {\n      for (var n = 0; n < t.length; n++) {\n        var r = t[n];\n        r.enumerable = r.enumerable || !1, r.configurable = !0, \"value\" in r && (r.writable = !0), Object.defineProperty(e, r.key, r);\n      }\n    }\n\n    var p = function () {\n      function e(t, n) {\n        !function (e, t) {\n          if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\");\n        }(this, e), this.initialize(t, n), this._pageContentDelimiter = [a.a.JCR_CONTENT];\n      }\n\n      var t, n, i;\n      return t = e, (n = [{\n        key: \"initialize\",\n        value: function value(e, t) {\n          t && (this._data = t), this._rootPath = e;\n        }\n      }, {\n        key: \"_getPageData\",\n        value: function value(e) {\n          if (this._data) return \"\" === e || e === this._data[a.a.PATH_PROP] || e === this.rootPath ? this._data : this._data[a.a.CHILDREN_PROP] && this._data[a.a.CHILDREN_PROP][e];\n        }\n      }, {\n        key: \"_findItemData\",\n        value: function value(e) {\n          var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : this._data,\n              n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : void 0,\n              i = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : \"\",\n              o = {\n            parent: n,\n            parentPath: i\n          },\n              s = t[a.a.ITEMS_PROP];\n          if (!s) return o;\n\n          for (var u in s) {\n            if (Object.prototype.hasOwnProperty.call(s, u)) {\n              var l = s[u];\n              if (u === e) return o.data = s[u], o.key = u, o;\n\n              var c = r.a.subpath(e, u),\n                  f = r.a._getStartStrings(c, this._pageContentDelimiter),\n                  h = r.a.join([i, u, f]);\n\n              if ((c = r.a.trimStrings(c, this._pageContentDelimiter)) !== e && (l = this._findItemData(c, l, l, h))) return l;\n            }\n          }\n\n          return o;\n        }\n      }, {\n        key: \"setData\",\n        value: function value(e, t) {\n          var n = r.a.getNodeName(e),\n              i = this.getData(r.a.getParentNodePath(e), !1);\n\n          if (i && i[a.a.ITEMS_PROP]) {\n            var o = s()(t);\n            i[a.a.ITEMS_PROP][n] = o.value;\n          }\n        }\n      }, {\n        key: \"getData\",\n        value: function value(e) {\n          var t = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1];\n          if (!e && \"string\" != typeof e) return t ? s()(this._data) : this._data;\n          if (e === this._rootPath || e === this._rootPath + \"/\" + a.a.JCR_CONTENT) return t ? s()(this._data) : this._data;\n\n          var n = r.a.splitPageContentPaths(e),\n              i = this._getPageData(n.pagePath);\n\n          if (!i || !n.itemPath) return t ? s()(i) : i;\n\n          var o = this._findItemData(n.itemPath, i);\n\n          return o ? t ? s()(o.data) : o.data : void 0;\n        }\n      }, {\n        key: \"insertData\",\n        value: function value(e, t, n) {\n          var i = arguments.length > 3 && void 0 !== arguments[3] && arguments[3];\n\n          if (t = s()(t), e) {\n            var o = r.a.isItem(e);\n\n            if (o || !this._data[a.a.CHILDREN_PROP]) {\n              var u = r.a.splitPageContentPaths(e),\n                  l = this._getPageData(u.pagePath),\n                  c = this._findItemData(u.itemPath, l),\n                  f = c.parent || l || this._data,\n                  h = r.a.getNodeName(u.itemPath);\n\n              if (f && Object.prototype.hasOwnProperty.call(f, a.a.ITEMS_PROP) && (f[a.a.ITEMS_PROP][h] = t, Object.prototype.hasOwnProperty.call(f, a.a.ITEMS_ORDER_PROP))) {\n                var d = f[a.a.ITEMS_ORDER_PROP].indexOf(n);\n                d > -1 ? f[a.a.ITEMS_ORDER_PROP].splice(i ? d : d + 1, 0, h) : f[a.a.ITEMS_ORDER_PROP].push(h);\n              }\n            } else this._data[a.a.CHILDREN_PROP][e] = t;\n          } else console.warn(\"No path provided for data:\", t);\n        }\n      }, {\n        key: \"removeData\",\n        value: function value(e) {\n          if (e) if (r.a.isItem(e) || !this._data[a.a.CHILDREN_PROP]) {\n            var t = r.a.splitPageContentPaths(e),\n                n = this._getPageData(t.pagePath),\n                i = this._findItemData(t.itemPath, n);\n\n            if (i.data) {\n              if (i && i.parent && Object.prototype.hasOwnProperty.call(i.parent, a.a.ITEMS_PROP)) {\n                var o = i.parent,\n                    s = r.a.getNodeName(t.itemPath);\n\n                if (delete o[a.a.ITEMS_PROP][s], delete i.data, delete i.parent, Object.prototype.hasOwnProperty.call(o, a.a.ITEMS_ORDER_PROP)) {\n                  var u = o[a.a.ITEMS_ORDER_PROP].indexOf(s);\n                  o[a.a.ITEMS_ORDER_PROP].splice(u, 1);\n                }\n\n                return i.parentPath;\n              }\n            } else console.warn(\"Item for path \".concat(e, \" was not found! Nothing to remove then.\"));\n          } else delete this._data[a.a.CHILDREN_PROP][e];\n        }\n      }, {\n        key: \"destroy\",\n        value: function value() {\n          this._data = null, this._rootPath = null, this._pageContentDelimiter = null, delete this._data, delete this._rootPath, delete this._pageContentDelimiter;\n        }\n      }, {\n        key: \"rootPath\",\n        get: function get() {\n          return this._rootPath;\n        }\n      }]) && d(t.prototype, n), i && d(t, i), e;\n    }();\n\n    function v(e, t) {\n      for (var n = 0; n < t.length; n++) {\n        var r = t[n];\n        r.enumerable = r.enumerable || !1, r.configurable = !0, \"value\" in r && (r.writable = !0), Object.defineProperty(e, r.key, r);\n      }\n    }\n\n    function _(e) {\n      if (!e) return \"\";\n      var t = r.a.internalize(e);\n      return this.modelStore && this.modelStore.rootPath && t === r.a.sanitize(this.modelStore.rootPath) ? \"\" : t;\n    }\n\n    function g(e) {\n      for (var t = function () {\n        var e = r.a.getMetaPropertyValue(i.a.PAGE_MODEL_ROUTE_FILTERS);\n        return e ? e.split(\",\") : [];\n      }(), n = 0, a = t.length; n < a; n++) {\n        if (new RegExp(t[n]).test(e)) return !0;\n      }\n\n      return !1;\n    }\n\n    var m = function () {\n      function e() {\n        !function (e, t) {\n          if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\");\n        }(this, e);\n      }\n\n      var t, n, o;\n      return t = e, (n = [{\n        key: \"_checkDependencies\",\n        value: function value() {\n          return this.modelClient ? this.modelStore ? Promise.resolve() : Promise.reject(\"No ModelManager registered\") : Promise.reject(\"No ModelClient registered\");\n        }\n      }, {\n        key: \"_toModelPath\",\n        value: function value(e) {\n          var t = r.a.addSelector(e, \"model\");\n          return t = r.a.addExtension(t, \"json\"), t = r.a.externalize(t), r.a.makeAbsolute(t);\n        }\n      }, {\n        key: \"initialize\",\n        value: function value(e) {\n          var t,\n              n,\n              o = this;\n          this.destroy(), e && \"string\" != typeof e ? e && (t = e.path, this._modelClient = e.modelClient, n = e.model) : t = e, this._listenersMap = {}, this._fetchPromises = {}, this._initPromise = null;\n          var s = r.a.internalize(r.a.getMetaPropertyValue(i.a.PAGE_MODEL_ROOT_URL)),\n              u = r.a.sanitize(r.a.getCurrentPathname()),\n              l = t || s || u;\n          return l || console.error(\"ModelManager.js\", \"Cannot initialize without an URL to fetch the root model\"), this._modelClient || (this._modelClient = new h.a()), this._editorClient = new f(this), this._modelStore = new p(l, n), this._initPromise = this._checkDependencies().then(function () {\n            var e = r.a.sanitize(l),\n                t = o.modelStore.getData(e);\n            return t ? (c(t), t) : o._fetchData(l).then(function (t) {\n              if (o.modelStore.initialize(e, t), g(u) || (h = s, !(f = u) || !h || r.a.sanitize(f) === r.a.sanitize(h)) || (l = u, (i = t) && l && i[a.a.CHILDREN_PROP] && i[a.a.CHILDREN_PROP][r.a.sanitize(l)])) {\n                var n = o.modelStore.getData();\n                return c(n), n;\n              }\n\n              return o._fetchData(u).then(function (e) {\n                o.modelStore.insertData(r.a.sanitize(u), e);\n                var t = o.modelStore.getData();\n                return c(t), t;\n              });\n              var i, l, f, h;\n            });\n          }), this._initPromise;\n        }\n      }, {\n        key: \"_fetchData\",\n        value: function value(e) {\n          var t = this;\n          if (Object.prototype.hasOwnProperty.call(this._fetchPromises, e)) return this._fetchPromises[e];\n          var n = this.modelClient.fetch(this._toModelPath(e));\n          return this._fetchPromises[e] = n, n.then(function (n) {\n            return delete t._fetchPromises[e], n;\n          })[\"catch\"](function (n) {\n            return delete t._fetchPromises[e], n;\n          }), n;\n        }\n      }, {\n        key: \"_storeData\",\n        value: function value(e, t) {\n          var n = r.a.isItem(e);\n          return this.modelStore.insertData(e, t), this._notifyListeners(e), n || this._notifyListeners(\"\"), t;\n        }\n      }, {\n        key: \"getData\",\n        value: function value(e) {\n          var t,\n              n = this,\n              r = !1;\n          return \"string\" == typeof e ? t = e : e && (t = e.path, r = e.forceReload), (this._initPromise || Promise.resolve()).then(function () {\n            return n._checkDependencies();\n          }).then(function () {\n            if (!r) {\n              var e = n.modelStore.getData(t);\n              if (e) return Promise.resolve(e);\n            }\n\n            return n._fetchData(t).then(function (e) {\n              return n._storeData(t, e);\n            });\n          });\n        }\n      }, {\n        key: \"_notifyListeners\",\n        value: function value(e) {\n          e = r.a.adaptPagePath.call(this, e);\n          var t = this._listenersMap[e];\n          t && t.length && t.forEach(function (n) {\n            try {\n              n();\n            } catch (n) {\n              console.error(\"Error in listener \" + t + \" at path \" + e + \" : \" + n);\n            }\n          });\n        }\n      }, {\n        key: \"addListener\",\n        value: function value(e, t) {\n          if (e || \"string\" == typeof e) {\n            var n = _.call(this, e);\n\n            this._listenersMap[n] = this._listenersMap[e] || [], this._listenersMap[n].push(t);\n          }\n        }\n      }, {\n        key: \"removeListener\",\n        value: function value(e, t) {\n          if (e) {\n            var n = _.call(this, e),\n                r = this._listenersMap[n];\n\n            if (r) {\n              var a = r.indexOf(t);\n              -1 !== a && r.splice(a, 1);\n            }\n          }\n        }\n      }, {\n        key: \"destroy\",\n        value: function value() {\n          this._fetchPromises = null, delete this._fetchPromises, this._listenersMap = null, delete this._listenersMap, this.modelClient && this.modelClient.destroy && this.modelClient.destroy(), this.modelStore && this.modelStore.destroy && this.modelStore.destroy(), this._editorClient && this._editorClient.destroy && this._editorClient.destroy();\n        }\n      }, {\n        key: \"modelClient\",\n        get: function get() {\n          return this._modelClient;\n        }\n      }, {\n        key: \"modelStore\",\n        get: function get() {\n          return this._modelStore;\n        }\n      }, {\n        key: \"rootPath\",\n        get: function get() {\n          return this.modelStore.rootPath;\n        }\n      }]) && v(t.prototype, n), o && v(t, o), e;\n    }();\n\n    t.a = new m();\n  }, function (e, t, n) {\n    \"use strict\";\n\n    t.a = {\n      PAGE_MODEL_INIT: \"cq-pagemodel-init\",\n      PAGE_MODEL_LOADED: \"cq-pagemodel-loaded\",\n      PAGE_MODEL_UPDATE: \"cq-pagemodel-update\",\n      PAGE_MODEL_ROUTE_CHANGED: \"cq-pagemodel-route-changed\"\n    };\n  }, function (e, t, n) {\n    \"use strict\";\n\n    function r(e, t) {\n      for (var n = 0; n < t.length; n++) {\n        var r = t[n];\n        r.enumerable = r.enumerable || !1, r.configurable = !0, \"value\" in r && (r.writable = !0), Object.defineProperty(e, r.key, r);\n      }\n    }\n\n    n.d(t, \"a\", function () {\n      return a;\n    });\n\n    var a = function () {\n      function e(t) {\n        !function (e, t) {\n          if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\");\n        }(this, e), this._apiHost = t || \"\", this._fetchPromises = {};\n      }\n\n      var t, n, a;\n      return t = e, (n = [{\n        key: \"fetch\",\n        value: function (e) {\n          function t(t) {\n            return e.apply(this, arguments);\n          }\n\n          return t.toString = function () {\n            return e.toString();\n          }, t;\n        }(function (e) {\n          if (!e) {\n            var t = \"Fetching model rejected for path: \" + e;\n            return Promise.reject(new Error(t));\n          }\n\n          var n = \"\".concat(this._apiHost).concat(e);\n          return fetch(n, {\n            credentials: \"same-origin\"\n          }).then(function (e) {\n            if (e.status >= 200 && e.status < 300) return e.json();\n            throw {\n              response: e\n            };\n          })[\"catch\"](function (e) {\n            return Promise.reject(e);\n          });\n        })\n      }, {\n        key: \"destroy\",\n        value: function value() {\n          this._apiHost = null, this._fetchPromises = null;\n        }\n      }]) && r(t.prototype, n), a && r(t, a), e;\n    }();\n  }, function (e, t, n) {\n    (function (e) {\n      function n(e, t) {\n        for (var n = 0, r = e.length - 1; r >= 0; r--) {\n          var a = e[r];\n          \".\" === a ? e.splice(r, 1) : \"..\" === a ? (e.splice(r, 1), n++) : n && (e.splice(r, 1), n--);\n        }\n\n        if (t) for (; n--; n) {\n          e.unshift(\"..\");\n        }\n        return e;\n      }\n\n      function r(e, t) {\n        if (e.filter) return e.filter(t);\n\n        for (var n = [], r = 0; r < e.length; r++) {\n          t(e[r], r, e) && n.push(e[r]);\n        }\n\n        return n;\n      }\n\n      t.resolve = function () {\n        for (var t = \"\", a = !1, i = arguments.length - 1; i >= -1 && !a; i--) {\n          var o = i >= 0 ? arguments[i] : e.cwd();\n          if (\"string\" != typeof o) throw new TypeError(\"Arguments to path.resolve must be strings\");\n          o && (t = o + \"/\" + t, a = \"/\" === o.charAt(0));\n        }\n\n        return (a ? \"/\" : \"\") + (t = n(r(t.split(\"/\"), function (e) {\n          return !!e;\n        }), !a).join(\"/\")) || \".\";\n      }, t.normalize = function (e) {\n        var i = t.isAbsolute(e),\n            o = \"/\" === a(e, -1);\n        return (e = n(r(e.split(\"/\"), function (e) {\n          return !!e;\n        }), !i).join(\"/\")) || i || (e = \".\"), e && o && (e += \"/\"), (i ? \"/\" : \"\") + e;\n      }, t.isAbsolute = function (e) {\n        return \"/\" === e.charAt(0);\n      }, t.join = function () {\n        var e = Array.prototype.slice.call(arguments, 0);\n        return t.normalize(r(e, function (e, t) {\n          if (\"string\" != typeof e) throw new TypeError(\"Arguments to path.join must be strings\");\n          return e;\n        }).join(\"/\"));\n      }, t.relative = function (e, n) {\n        function r(e) {\n          for (var t = 0; t < e.length && \"\" === e[t]; t++) {\n            ;\n          }\n\n          for (var n = e.length - 1; n >= 0 && \"\" === e[n]; n--) {\n            ;\n          }\n\n          return t > n ? [] : e.slice(t, n - t + 1);\n        }\n\n        e = t.resolve(e).substr(1), n = t.resolve(n).substr(1);\n\n        for (var a = r(e.split(\"/\")), i = r(n.split(\"/\")), o = Math.min(a.length, i.length), s = o, u = 0; u < o; u++) {\n          if (a[u] !== i[u]) {\n            s = u;\n            break;\n          }\n        }\n\n        var l = [];\n\n        for (u = s; u < a.length; u++) {\n          l.push(\"..\");\n        }\n\n        return (l = l.concat(i.slice(s))).join(\"/\");\n      }, t.sep = \"/\", t.delimiter = \":\", t.dirname = function (e) {\n        if (\"string\" != typeof e && (e += \"\"), 0 === e.length) return \".\";\n\n        for (var t = e.charCodeAt(0), n = 47 === t, r = -1, a = !0, i = e.length - 1; i >= 1; --i) {\n          if (47 === (t = e.charCodeAt(i))) {\n            if (!a) {\n              r = i;\n              break;\n            }\n          } else a = !1;\n        }\n\n        return -1 === r ? n ? \"/\" : \".\" : n && 1 === r ? \"/\" : e.slice(0, r);\n      }, t.basename = function (e, t) {\n        var n = function (e) {\n          \"string\" != typeof e && (e += \"\");\n          var t,\n              n = 0,\n              r = -1,\n              a = !0;\n\n          for (t = e.length - 1; t >= 0; --t) {\n            if (47 === e.charCodeAt(t)) {\n              if (!a) {\n                n = t + 1;\n                break;\n              }\n            } else -1 === r && (a = !1, r = t + 1);\n          }\n\n          return -1 === r ? \"\" : e.slice(n, r);\n        }(e);\n\n        return t && n.substr(-1 * t.length) === t && (n = n.substr(0, n.length - t.length)), n;\n      }, t.extname = function (e) {\n        \"string\" != typeof e && (e += \"\");\n\n        for (var t = -1, n = 0, r = -1, a = !0, i = 0, o = e.length - 1; o >= 0; --o) {\n          var s = e.charCodeAt(o);\n          if (47 !== s) -1 === r && (a = !1, r = o + 1), 46 === s ? -1 === t ? t = o : 1 !== i && (i = 1) : -1 !== t && (i = -1);else if (!a) {\n            n = o + 1;\n            break;\n          }\n        }\n\n        return -1 === t || -1 === r || 0 === i || 1 === i && t === r - 1 && t === n + 1 ? \"\" : e.slice(t, r);\n      };\n      var a = \"b\" === \"ab\".substr(-1) ? function (e, t, n) {\n        return e.substr(t, n);\n      } : function (e, t, n) {\n        return t < 0 && (t = e.length + t), e.substr(t, n);\n      };\n    }).call(this, n(11));\n  }, function (e, t) {\n    e.exports = require(\"url\");\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.r(t);\n    var r = n(4);\n    n.d(t, \"ModelManager\", function () {\n      return r.a;\n    });\n    var a = n(6);\n    n.d(t, \"ModelClient\", function () {\n      return a.a;\n    });\n    var i = n(0);\n    n.d(t, \"PathUtils\", function () {\n      return i.a;\n    });\n    var o = n(1);\n    n.d(t, \"Constants\", function () {\n      return o.a;\n    }), n(10);\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.r(t), n.d(t, \"ROUTER_MODES\", function () {\n      return s;\n    }), n.d(t, \"getModelPath\", function () {\n      return u;\n    }), n.d(t, \"isModelRouterEnabled\", function () {\n      return l;\n    }), n.d(t, \"dispatchRouteChanged\", function () {\n      return c;\n    }), n.d(t, \"routeModel\", function () {\n      return f;\n    });\n    var r = n(5),\n        a = n(0),\n        i = n(3),\n        o = n(4),\n        s = {\n      DISABLED: \"disabled\",\n      CONTENT_PATH: \"path\"\n    };\n\n    function u(e) {\n      var t,\n          n = (t = e || window.location.pathname).indexOf(\".\");\n\n      if (n < 0) {\n        var r = t.indexOf(\"?\");\n        n = r < 0 ? t.length : r;\n      }\n\n      return t.substr(0, n);\n    }\n\n    function l() {\n      if (!a.a.isBrowser()) return !1;\n      var e = a.a.getMetaPropertyValue(i.a.PAGE_MODEL_ROUTER);\n      return !e || s.DISABLED !== e;\n    }\n\n    function c(e) {\n      o.a.getData({\n        path: e\n      }).then(function (e) {\n        a.a.dispatchGlobalCustomEvent(r.a.PAGE_MODEL_ROUTE_CHANGED, {\n          detail: {\n            model: e\n          }\n        });\n      });\n    }\n\n    function f(e) {\n      if (l()) {\n        var t = u(e);\n        t && \"/\" !== t && !Object(o.b)(t) && c(t);\n      }\n    }\n\n    if (l()) {\n      var h = window.history.pushState,\n          d = window.history.replaceState;\n      window.history.pushState = function (e, t, n) {\n        return f(n), h.apply(history, arguments);\n      }, window.history.replaceState = function (e, t, n) {\n        return f(n), d.apply(history, arguments);\n      };\n    }\n  }, function (e, t) {\n    var n,\n        r,\n        a = e.exports = {};\n\n    function i() {\n      throw new Error(\"setTimeout has not been defined\");\n    }\n\n    function o() {\n      throw new Error(\"clearTimeout has not been defined\");\n    }\n\n    function s(e) {\n      if (n === setTimeout) return setTimeout(e, 0);\n      if ((n === i || !n) && setTimeout) return n = setTimeout, setTimeout(e, 0);\n\n      try {\n        return n(e, 0);\n      } catch (t) {\n        try {\n          return n.call(null, e, 0);\n        } catch (t) {\n          return n.call(this, e, 0);\n        }\n      }\n    }\n\n    !function () {\n      try {\n        n = \"function\" == typeof setTimeout ? setTimeout : i;\n      } catch (e) {\n        n = i;\n      }\n\n      try {\n        r = \"function\" == typeof clearTimeout ? clearTimeout : o;\n      } catch (e) {\n        r = o;\n      }\n    }();\n    var u,\n        l = [],\n        c = !1,\n        f = -1;\n\n    function h() {\n      c && u && (c = !1, u.length ? l = u.concat(l) : f = -1, l.length && d());\n    }\n\n    function d() {\n      if (!c) {\n        var e = s(h);\n        c = !0;\n\n        for (var t = l.length; t;) {\n          for (u = l, l = []; ++f < t;) {\n            u && u[f].run();\n          }\n\n          f = -1, t = l.length;\n        }\n\n        u = null, c = !1, function (e) {\n          if (r === clearTimeout) return clearTimeout(e);\n          if ((r === o || !r) && clearTimeout) return r = clearTimeout, clearTimeout(e);\n\n          try {\n            r(e);\n          } catch (t) {\n            try {\n              return r.call(null, e);\n            } catch (t) {\n              return r.call(this, e);\n            }\n          }\n        }(e);\n      }\n    }\n\n    function p(e, t) {\n      this.fun = e, this.array = t;\n    }\n\n    function v() {}\n\n    a.nextTick = function (e) {\n      var t = new Array(arguments.length - 1);\n      if (arguments.length > 1) for (var n = 1; n < arguments.length; n++) {\n        t[n - 1] = arguments[n];\n      }\n      l.push(new p(e, t)), 1 !== l.length || c || s(d);\n    }, p.prototype.run = function () {\n      this.fun.apply(null, this.array);\n    }, a.title = \"browser\", a.browser = !0, a.env = {}, a.argv = [], a.version = \"\", a.versions = {}, a.on = v, a.addListener = v, a.once = v, a.off = v, a.removeListener = v, a.removeAllListeners = v, a.emit = v, a.prependListener = v, a.prependOnceListener = v, a.listeners = function (e) {\n      return [];\n    }, a.binding = function (e) {\n      throw new Error(\"process.binding is not supported\");\n    }, a.cwd = function () {\n      return \"/\";\n    }, a.chdir = function (e) {\n      throw new Error(\"process.chdir is not supported\");\n    }, a.umask = function () {\n      return 0;\n    };\n  }]);\n});","map":{"version":3,"sources":["webpack://cqSpaPageModelManager/webpack/universalModuleDefinition","webpack://cqSpaPageModelManager/webpack/bootstrap","webpack://cqSpaPageModelManager/src/InternalConstants.js","webpack://cqSpaPageModelManager/src/PathUtils.js","webpack://cqSpaPageModelManager/src/Constants.js","webpack:/cqSpaPageModelManager/external \"clone\"","webpack://cqSpaPageModelManager/src/MetaProperty.js","webpack://cqSpaPageModelManager/src/EditorClient.js","webpack://cqSpaPageModelManager/src/ModelStore.js","webpack://cqSpaPageModelManager/src/ModelManager.js","webpack://cqSpaPageModelManager/src/EventType.js","webpack://cqSpaPageModelManager/src/ModelClient.js","webpack://cqSpaPageModelManager/node_modules/path-browserify/index.js","webpack:/cqSpaPageModelManager/external \"url\"","webpack://cqSpaPageModelManager/index.js","webpack://cqSpaPageModelManager/src/ModelRouter.js","webpack://cqSpaPageModelManager/node_modules/process/browser.js"],"names":["root","factory","exports","module","define","amd","self","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","DEFAULT_SLING_MODEL_SELECTOR","DEFAULT_MODEL_JSON_EXTENSION","InternalConstants","CONTEXT_PATH_REGEXP","JCR_CONTENT_PATTERN","Constants","JCR_CONTENT","PathUtils","window","e","location","getCurrentPathname","matches","match","index","slice","path","rootPath","localPath","internalize","sanitize","url","contextPath","getContextPath","startsWith","replace","RegExp","propertyName","isBrowser","meta","document","head","querySelector","content","convertToModelUrl","metaModelUrl","getMetaPropertyValue","MetaProperty","PAGE_MODEL_ROOT_URL","getCurrentPageModelUrl","sanitizedPath","parse","pathname","selectorIndex","indexOf","substr","normalizePath","extension","length","extensionPath","exec","queue","selector","undefined","eventName","options","dispatchEvent","CustomEvent","paths","normalize","filter","join","splashIndex","lastIndexOf","substring","test","targetPath","targetPathChildren","makeRelative","split","rootPathChildren","delimitators","forEach","delimitator","newPaths","delim","makeAbsolute","concat","endsWith","lastPath","splice","pagePath","dataPath","splitPaths","itemPath","strings","str","returnStr","TYPE_PROP","ITEMS_PROP","ITEMS_ORDER_PROP","PATH_PROP","CHILDREN_PROP","HIERARCHY_TYPE_PROP","require","PAGE_MODEL_ROUTE_FILTERS","PAGE_MODEL_ROUTER","triggerPageModelLoaded","model","dispatchGlobalCustomEvent","EventType","PAGE_MODEL_LOADED","detail","clone","EditorClient","ModelManager","_modelManager","_windowListener","event","msg","console","error","_updateModel","addEventListener","PAGE_MODEL_UPDATE","cmd","data","siblingName","insertBefore","modelStore","setData","_notifyListeners","removeData","getParentNodePath","getNodeName","_modelStore","insertData","log","_data","removeEventListener","ModelStore","initialize","_pageContentDelimiter","_rootPath","parent","parentPath","answer","items","pathKey","childItem","subPath","subpath","pageDelimiter","_getStartStrings","childParentPath","trimStrings","_findItemData","newData","itemKey","getData","localData","immutable","dataPaths","splitPageContentPaths","pageData","_getPageData","result","warn","isItem","itemName","push","childPath","modelRootPath","adaptPagePath","routeFilters","isRouteExcluded","route","getRouteFilters","_modelClient","modelClient","Promise","reject","resolve","addSelector","addExtension","externalize","config","destroy","initialModel","_listenersMap","_fetchPromises","_initPromise","metaPropertyModelUrl","currentPathname","rootModelURL","ModelClient","_editorClient","_checkDependencies","then","rootModelPath","_fetchData","rootModel","promise","fetch","_toModelPath","obj","forceReload","item","_storeData","listenersForPath","listener","callback","adaptedPath","PAGE_MODEL_INIT","PAGE_MODEL_ROUTE_CHANGED","apiHost","_apiHost","modelPath","err","Error","credentials","response","status","json","normalizeArray","parts","allowAboveRoot","up","last","unshift","resolvedPath","resolvedAbsolute","arguments","process","cwd","TypeError","charAt","isAbsolute","trailingSlash","Array","relative","from","to","trim","arr","start","end","fromParts","toParts","Math","min","samePartsLength","outputParts","sep","delimiter","dirname","code","charCodeAt","hasRoot","matchedSlash","basename","ext","f","extname","startDot","startPart","preDotState","xs","res","len","ROUTER_MODES","DISABLED","CONTENT_PATH","getModelPath","localUrl","endPosition","queryPosition","isModelRouterEnabled","modelRouterMetaType","dispatchRouteChanged","ModelManagerSerice","routeModel","pushState","history","replaceState","state","title","apply","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","setTimeout","clearTimeout","runTimeout","fun","marker","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","runClearTimeout","nextTick","args","Item","array","browser","env","argv","version","versions","noop","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","chdir","dir","umask"],"mappings":"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","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cqSpaPageModelManager\"] = factory();\n\telse\n\t\troot[\"cqSpaPageModelManager\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\nconst DEFAULT_SLING_MODEL_SELECTOR = 'model';\n\nconst InternalConstants = {\n\n    DEFAULT_SLING_MODEL_SELECTOR: DEFAULT_SLING_MODEL_SELECTOR,\n\n    DEFAULT_MODEL_JSON_EXTENSION: '.' + DEFAULT_SLING_MODEL_SELECTOR + '.json'\n};\n\nexport default InternalConstants;","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\nimport Constants from \"./Constants\";\nimport InternalConstants from \"./InternalConstants\";\nimport MetaProperty from \"./MetaProperty\";\nimport { normalize as normalizePath } from \"path\";\nimport url from \"url\";\n\n/**\n * Regexp used to extract the context path of a location.\n * The context path is extracted by assuming that the location starts with the context path followed by one of the following node names\n */\nconst CONTEXT_PATH_REGEXP = /(?:\\/)(?:content|apps|libs|etc|etc.clientlibs|conf|mnt\\/overlay)(?:\\/)/;\n\nconst JCR_CONTENT_PATTERN = '(.+)/' + Constants.JCR_CONTENT +'/(.+)';\n\n/**\n * Helper functions related to path manipulation.\n *\n * @namespace PathUtils\n */\nexport class PathUtils {\n\n    /**\n     * Returns if the code executes in the browser context or not by checking for the\n     * existance of the window object\n     *\n     * @returns {Boolean} the result of the check of the existance of the window object\n     */\n    static isBrowser() {\n        try {\n            return typeof window !== 'undefined';\n        }catch(e){\n            return false;\n        }\n    }\n\n    /**\n     * Returns the context path of the given location.\n     * If no location is provided, it fallbacks to the current location.\n     * @param {String} [location] - Location to be used to detect the context path from.\n     * @returns {String}\n     */\n    static getContextPath(location) {\n        location = location || this.getCurrentPathname();\n        if (!location) {\n            return \"\";\n        }\n\n        let matches = location.match(CONTEXT_PATH_REGEXP);\n        let contextPath = (matches && (matches.index > 0)) ? location.slice(0, matches.index) : '';\n\n        return contextPath;\n    }\n\n    /**\n     * Adapts the provided path to a valid model path.\n     * Returns an empty string if the given path is equal to the root model path.\n     * This function is a utility tool that converts a provided root model path into an internal specific empty path\n     *\n     * @param {string} [path]   - raw model path\n     * @return {string} the valid model path\n     *\n     * @private\n     */\n    static adaptPagePath(path, rootPath) {\n        if (!path) {\n            return '';\n        }\n\n        if (!rootPath) {\n            return path;\n        }\n\n        const localPath = PathUtils.internalize(path);\n        const localRootModelPath = PathUtils.sanitize(rootPath);\n\n        return localPath === localRootModelPath ? '' : localPath;\n    }\n\n    /**\n     * Returns the given URL externalized by adding the optional context path\n     *\n     * @param {string} url - URL to externalize\n     * @returns {string}\n     */\n    static externalize(url) {\n        const contextPath = this.getContextPath();\n        let externalizedPath = url.startsWith(contextPath) ? url : `${contextPath}${url}`;\n\n        return externalizedPath;\n    }\n\n    /**\n     * Returns the given URL internalized by removing the optional context path\n     *\n     * @param {string} url - URL to internalize\n     * @returns {string}\n     */\n    static internalize(url) {\n        if (!url) {\n            return url;\n        }\n\n        const contextPath = this.getContextPath();\n        let internalizedPath = url.replace(new RegExp(`^${contextPath}/`), '/');\n\n        return internalizedPath;\n    }\n\n    /**\n     * Returns the value of the meta property with the given key\n     *\n     * @param {string} propertyName  - name of the meta property\n     * @return {string|undefined}\n     */\n    static getMetaPropertyValue(propertyName) {\n        if (this.isBrowser()) {\n            const meta = document.head.querySelector('meta[property=\"' + propertyName + '\"]');\n            return meta && meta.content;\n        }\n    }\n\n    /**\n     * Returns a model path for the given URL\n     *\n     * @param {string} url - Raw URL for which to get a model URL\n     * @return {string|undefined}\n     */\n    static convertToModelUrl(url) {\n        return url && url.replace && url.replace(/\\.htm(l)?$/, InternalConstants.DEFAULT_MODEL_JSON_EXTENSION);\n    }\n\n    /**\n     * Returns the model URL as contained in the current page URL\n     *\n     * @return {string}\n     */\n    static getCurrentPageModelUrl() {\n        // extract the model from the pathname\n        return this.convertToModelUrl(this.getCurrentPathname());\n    }\n\n    /**\n     * Returns the URL of the page model to initialize the page model manager with.\n     * It is either derived from a meta tag property called 'cq:pagemodel_root_url' or from the given location.\n     * If no location is provided, it derives it from the current location.\n     *\n     * @param {String} [url]   - path or URL to be used to derive the page model URL from\n     * @returns {String}\n     */\n    static getModelUrl(url) {\n        // Model path extracted from the given url\n        if (url && url.replace) {\n            return this.convertToModelUrl(url);\n        }\n\n        // model path from the meta property\n        const metaModelUrl = this.getMetaPropertyValue(MetaProperty.PAGE_MODEL_ROOT_URL);\n\n        if (metaModelUrl) {\n            return metaModelUrl;\n        }\n\n        // Model URL extracted from the current page URL\n        return this.getCurrentPageModelUrl();\n    }\n\n    /**\n     * Returns the given path after sanitizing it.\n     * This function should be called on page paths before storing them in the page model,\n     * to make sure only properly formatted paths (e.g., \"/content/mypage\") are stored.\n     * @param {string} path - Path of the page to be sanitized.\n     * @return {string|undefined}\n     */\n    static sanitize(path) {\n        if (!path) {\n            return;\n        }\n\n        // Parse URL, then remove protocol and domain (if they exist).\n        // Important: URLs starting with \"//some/path\" will resolve to\n        // \"http://some/path\" or \"https://some/path\" (note that the first\n        // substring will be used as the hostname)\n        let sanitizedPath = url.parse(path, false, true).pathname;\n\n        // Remove context path (if it exists)\n        sanitizedPath = this.internalize(sanitizedPath);\n\n        // Remove selectors (if they exist)\n        let selectorIndex = sanitizedPath.indexOf(\".\");\n        if (selectorIndex > -1) {\n            sanitizedPath = sanitizedPath.substr(0, selectorIndex);\n        }\n\n        // Normalize path (replace multiple consecutive slashes with a single\n        // one). It's important that the final sanitized URL does not start with\n        // \"//\" as this might lead to resources from other sites being loaded\n        sanitizedPath = normalizePath(sanitizedPath);\n\n        return sanitizedPath;\n    }\n\n    /**\n     * Returns the given path extended with the given extension.\n     * @param {String} path - Path to be extended.\n     * @param {String} extension - Extension to be added.\n     * @returns {String}\n     */\n    static addExtension(path, extension) {\n        if (!extension || extension.length < 1) {\n            return path;\n        }\n\n        if (!extension.startsWith(\".\")) {\n            extension = \".\" + extension;\n        }\n\n        if (!path || path.length < 1 || path.indexOf(extension) > -1) {\n            return path;\n        }\n\n        let extensionPath = path;\n\n        // Groups\n        // 1. the resource\n        // 2. the selectors and the extension\n        // 3. the suffix\n        // 4. the parameters\n        let match = /^((?:[/a-zA-Z0-9:_-]*)+)(?:\\.?)([a-zA-Z0-9._-]*)(?:\\/?)([a-zA-Z0-9/._-]*)(?:\\??)([a-zA-Z0-9=&]*)$/g.exec(\n            path\n        );\n        let queue = \"\";\n\n        if (match && match.length > 2) {\n            // suffix\n            queue = match[3] ? \"/\" + match[3] : \"\";\n            // parameters\n            queue += match[4] ? \"?\" + match[4] : \"\";\n\n            extensionPath =\n                match[1] +\n                \".\" +\n                match[2].replace(/\\.htm(l)?/, extension) +\n                queue;\n        }\n\n        return extensionPath.indexOf(extension) > -1\n            ? extensionPath\n            : extensionPath + extension + queue;\n    }\n\n    /**\n     * Returns the given path extended with the given selector.\n     * @param {String} path - Path to be extended.\n     * @param {String} selector - Selector to be added.\n     * @returns {String}\n     */\n    static addSelector(path, selector) {\n        if (!selector || selector.length < 1) {\n            return path;\n        }\n\n        if (!selector.startsWith(\".\")) {\n            selector = \".\" + selector;\n        }\n\n        if (!path || path.length < 1 || path.indexOf(selector) > -1) {\n            return path;\n        }\n\n        let index = path.indexOf(\".\") || path.length;\n\n        if (index < 0) {\n            return path + selector;\n        }\n\n        return path.slice(0, index) + selector + path.slice(index, path.length);\n    }\n\n    /**\n     * Returns the current location as a string.\n     * @returns {String}\n     */\n    static getCurrentPathname() {\n        return this.isBrowser() ? window.location.pathname : undefined;\n    }\n\n    /**\n     * Dispatches a custom event on the window object, when in the browser context\n     *\n     * @param  {String} eventName - the name of the custom event\n     * @param {Object} options - the custom event options\n     */\n    static dispatchGlobalCustomEvent(eventName, options) {\n        if (this.isBrowser()) {\n            window.dispatchEvent(new CustomEvent(eventName, options));\n        }\n    }\n\n    /**\n     * Joins given path segments into a string using /\n     *\n     * @param paths\n     * @returns {string}\n     */\n    static join (paths) {\n        return paths ? this.normalize(paths.filter((path) => path).join('/')) : \"\";\n    }\n\n    /**\n     * Normalizes given path by replacing repeated / with a single one\n     *\n     * @param {string} path\n     * @returns {string}\n     */\n    static normalize(path) {\n        if (!path) return \"\";\n        return path ? path.replace(/(\\/+)/g, '/') : \"\";\n    }\n\n    /**\n     * Returns path that starts with /\n     *\n     * @param {string} path\n     * @returns {*}\n     */\n    static makeAbsolute(path) {\n        if (!path || (typeof path !== \"string\")) return \"\";\n        return path.startsWith('/') ? path : \"/\" + path;\n    }\n\n    /**\n     * Returns path without the leading /\n     *\n     * @param path\n     * @returns {*}\n     */\n    static makeRelative(path) {\n        if (!path || (typeof path !== \"string\")) return \"\";\n        return path.startsWith('/') ? path.slice(1) : path;\n    }\n\n    /**\n     * Returns path to the direct parent\n     *\n     * @param path\n     * @returns {*|boolean|string}\n     */\n    static getParentNodePath(path) {\n        const splashIndex = path.lastIndexOf('/') + 1;\n        return path && typeof path === 'string' && splashIndex > 0 && splashIndex < path.length && path.substring(0, splashIndex - 1);\n    }\n\n    /**\n     * Checks if given path is an JCR path\n     *\n     * @param path\n     * @returns {boolean}\n     */\n    static isItem(path) {\n        return new RegExp(JCR_CONTENT_PATTERN).test(path);\n    }\n\n    /**\n     * Returns the name of the last node of the given path\n     * @param path\n     * @returns {*|boolean|string}\n     */\n    static getNodeName(path) {\n        const splashIndex = path.lastIndexOf('/') + 1;\n        return path && typeof path === 'string' && splashIndex < path.length && path.substring(splashIndex, path.length);\n    }\n\n    /**\n     * Returns the subpath of the targetPath relative to the rootPath,\n     * or the targetPath if the rootPath is not a root of the targetPath.\n     *\n     * @param targetPath\n     * @param rootPath\n     * @returns {*}\n     */\n    static subpath(targetPath, rootPath) {\n        if (!targetPath) {\n            return \"\";\n        }\n\n        let targetPathChildren = PathUtils.makeRelative(targetPath).split('/');\n        let rootPathChildren = PathUtils.makeRelative(rootPath).split('/');\n\n        if (targetPathChildren.length < rootPathChildren.length) {\n            return targetPath;\n        }\n\n        let index;\n        for(index = 0; index < rootPathChildren.length; ++index) {\n            if (targetPathChildren[index] !== rootPathChildren[index]) {\n                break;\n            }\n        }\n\n        if (index === rootPathChildren.length) {\n            return targetPathChildren.slice(index).join(\"/\");\n        } else {\n            return targetPath;\n        }\n    }\n\n    /**\n     * Returns an array of segments of the path, split by the custom set of delimitators passed as an array.\n     *\n     * @param {string} path\n     * @param {array} delimitators\n     * @returns {*}\n     */\n    static splitByDelimitators(path, delimitators) {\n        let paths = [path];\n        delimitators.forEach((delimitator) => {\n            let newPaths = [];\n            let delim = PathUtils.normalize(PathUtils.makeAbsolute(delimitator) + \"/\");\n            paths.forEach((path) => {\n                newPaths = newPaths.concat(path.split(delim));\n                if (path.endsWith(delimitator)) {\n                    let lastPath = newPaths.splice(newPaths.length-1, 1)[0];\n                    if (lastPath !== delimitator) {\n                        newPaths = newPaths.concat(lastPath.split(PathUtils.makeAbsolute(delimitator)));\n                    }\n                }\n                newPaths = newPaths.filter((path) => path);\n            });\n            paths = newPaths;\n        });\n        return paths;\n    }\n\n    /**\n     * Returns an JCR path based on pagePath and dataPath\n     *\n     * @param pagePath  path to the page\n     * @param dataPath  path to the item on the page\n     * @returns {string}\n     */\n    static _getJCRPath(pagePath, dataPath) {\n        return pagePath + '/' + Constants.JCR_CONTENT + '/' + dataPath;\n    }\n\n    /**\n     * Returns object containing pagePath (path to a page) and, if exists, itemPath (path to the item on that page)\n     * from the passed path\n     *\n     * @param {string} path\n     * @returns {{pagePath}}\n     */\n    static splitPageContentPaths(path) {\n        if (!path && typeof path !== 'string') {\n            return;\n        }\n\n        const splitPaths = path.split('/' + Constants.JCR_CONTENT + '/');\n\n        let split = {\n            pagePath: splitPaths[0]\n        };\n\n        if (splitPaths.length > 1) {\n            split.itemPath = splitPaths[1];\n        }\n\n        return split;\n    }\n\n    /**\n     * Returns path that is no longer prefixed nor suffixed by the set of strings passed as an array\n     *\n     * @param path\n     * @param {array} strings\n     * @returns {*}\n     */\n    static trimStrings(path, strings) {\n        strings.forEach((str) => {\n            while(path.startsWith(str)) {\n                path = PathUtils.makeRelative(path.slice(str.length));\n            }\n\n            while(path.endsWith(str)) {\n                path = path.slice(0, path.length - str.length);\n                if (path.endsWith('/')) {\n                    path = path.slice(0, path.length - 1);\n                }\n            }\n        });\n        return path;\n    }\n\n    static _getStartStrings(path, strings) {\n        let returnStr = \"\";\n        strings.forEach((str) => {\n            while(path.startsWith(str)) {\n                path = PathUtils.makeRelative(path.slice(str.length));\n                returnStr = returnStr + \"/\" + str;\n            }\n        });\n        return PathUtils.makeRelative(returnStr);\n    }\n}\n","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/**\n * Useful variables for interacting with CQ/AEM components\n *\n * @namespace Constants\n */\nconst Constants = {\n\n    /**\n     * Type of the item\n     *\n     * @type {string}\n     */\n    TYPE_PROP: ':type',\n\n    /**\n     * List of child items of an item\n     *\n     * @type {string}\n     */\n    ITEMS_PROP: ':items',\n\n    /**\n     * Order in which the items should be listed\n     *\n     * @type {string}\n     */\n    ITEMS_ORDER_PROP: ':itemsOrder',\n\n    /**\n     * Path of an item\n     *\n     * @type {string}\n     */\n    PATH_PROP: ':path',\n\n    /**\n     * Children of a hierarchical item\n     *\n     * @type {string}\n     */\n    CHILDREN_PROP: ':children',\n\n    /**\n     * Hierarchical type of the item\n     */\n    HIERARCHY_TYPE_PROP: ':hierarchyType',\n\n    /**\n     * JCR CONTENT Node\n     */\n    JCR_CONTENT: \"jcr:content\"\n};\n\nexport default Constants;\n","module.exports = require(\"clone\");","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/**\n * Names of the meta properties associated with the PageModelProvider and ModelRouter\n *\n * @type {{PAGE_MODEL_ROOT_URL: string, PAGE_MODEL_ROUTE_FILTERS: string, PAGE_MODEL_ROUTER: string}}\n */\nconst MetaProperty = {\n\n    PAGE_MODEL_ROOT_URL: 'cq:pagemodel_root_url',\n\n    PAGE_MODEL_ROUTE_FILTERS: 'cq:pagemodel_route_filters',\n\n    PAGE_MODEL_ROUTER: 'cq:pagemodel_router'\n\n};\n\nexport default MetaProperty;","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\nimport { PathUtils } from \"./PathUtils\";\nimport clone from 'clone';\nimport EventType from \"./EventType\";\n\n/**\n * Broadcast an event to indicate the page model has been loaded\n *\n * @param {{}} model - model item to be added to the broadcast payload\n * @fires cq-pagemodel-loaded\n */\nexport function triggerPageModelLoaded(model) {\n    // Deep copy to protect the internal state of the page mode\n    PathUtils.dispatchGlobalCustomEvent(EventType.PAGE_MODEL_LOADED, {\n        detail: {\n            model: clone(model)\n        }\n    });\n}\n\n/**\n * The EditorClient is responsible for the interactions with the Page Editor.\n */\nexport class EditorClient {\n\n    constructor(ModelManager) {\n        this._modelManager = ModelManager;\n\n        this._windowListener = (event) => {\n            if (!event || !event.detail || !event.detail.msg) {\n                console.error('EditorService.js', 'No message passed to cq-pagemodel-update', event);\n                return;\n            }\n\n            this._updateModel(event.detail.msg);\n        };\n\n        if (PathUtils.isBrowser()) {\n            window.addEventListener(EventType.PAGE_MODEL_UPDATE, this._windowListener);\n        }\n    }\n\n    /**\n     * Updates the page model with the given data\n     *\n     * @param {Object} msg - Object containing the data to update the page model\n     * @property {String} msg.dataPath - Relative data path in the PageModel which needs to be updated\n     * @property {String} msg.pagePath - Absolute page path corresponding to the page in the PageModel which needs to be updated\n     * @param {String} msg.cmd - Command Action requested via Editable on the content Node\n     * @param {Object} msg.data - Data that needs to be updated in the PageModel at {path}\n     *\n     * @fires cq-pagemodel-loaded\n     *\n     * @private\n     */\n    _updateModel(msg) {\n        if (!msg || !msg.cmd || !msg.path) {\n            console.error('PageModelManager.js', 'Not enough data received to update the page model');\n            return;\n        }\n        // Path in the PageModel which needs to be updated\n        let path = msg.path;\n        // Command Action requested via Editable on the content Node\n        let cmd = msg.cmd;\n        // Data that needs to be updated in the page model at the given path\n        let data = clone(msg.data);\n\n        let siblingName;\n        let itemPath;\n        let insertBefore;\n\n        switch(cmd) {\n            case 'replace':\n                this._modelManager.modelStore.setData(path, data);\n                this._modelManager._notifyListeners(path);\n                break;\n\n            case 'delete':\n                this._modelManager.modelStore.removeData(path);\n                this._modelManager._notifyListeners(PathUtils.getParentNodePath(path));\n                break;\n\n            case 'insertBefore':\n                insertBefore = true;\n                // No break as we want both insert command to be treated the same way\n                // eslint-disable-next-line no-fallthrough\n            case 'insertAfter':\n                // The logic relative to the item path and sibling between the editor and the ModelManager is reversed\n                // Adapting the command to the ModelManager API\n                siblingName = PathUtils.getNodeName(path);\n                itemPath = PathUtils.getParentNodePath(path) + \"/\" + data.key;\n                this._modelManager._modelStore.insertData(itemPath, data.value, siblingName, insertBefore);\n                this._modelManager._notifyListeners(PathUtils.getParentNodePath(path));\n\n                break;\n\n            default:\n                // \"replaceContent\" command not supported\n                // \"moveBefore\", \"moveAfter\" commands not supported.\n                // As instead, we are replacing source and destination parents because they can contain data about the item we want to relocate\n                console.log('EditorClient', 'unsupported command:', cmd);\n        }\n\n        triggerPageModelLoaded(this._modelManager.modelStore._data);\n    }\n\n    /**\n     * @private\n     */\n    destroy() {\n        this._modelManager = null;\n        delete this._modelManager;\n\n        if (PathUtils.isBrowser()) {\n            window.removeEventListener(EventType.PAGE_MODEL_UPDATE, this._windowListener);\n        }\n    }\n}","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\nimport clone from 'clone';\nimport Constants from \"./Constants\";\nimport { PathUtils } from \"./PathUtils\";\n\n/**\n * The ModelStore is in charge of providing access to the data model. It provides the CRUD operations over the model.\n * To protect the integrity of the data it initially returns immutable data. If needed, you can request a mutable object.\n */\nexport class ModelStore {\n\n    /**\n     * Item wrapper containing information about the item parent\n     *\n     * @typedef {Object} ItemWrapper\n     * @property {string} [key]             - Name of the item\n     * @property {{}} [data]                - Item data\n     * @property {{}} [parent]                - Parent item\n     * @property {string} [parentPath]        - Path of the parent item\n     */\n\n    /**\n     * @param {string} [rootPath]     - Root path of the model\n     * @param {{}} [data]             - Initial model\n     */\n    constructor(rootPath, data) {\n        this.initialize(rootPath, data);\n        this._pageContentDelimiter = [Constants.JCR_CONTENT];\n    }\n\n    /**\n     * Initializes the the ModelManager\n     *\n     * @param {string} rootPath     - Root path of the model\n     * @param {{}} data             - Initial model\n     */\n    initialize(rootPath, data) {\n        if (data) {\n            this._data = data;\n        }\n\n        this._rootPath = rootPath;\n    }\n\n    /**\n     * Returns the current root path\n     *\n     * @return {string}\n     */\n    get rootPath() {\n        return this._rootPath;\n    }\n\n    /**\n     *\n     * @param {string} pagePath - Path of the page\n     *\n     * @return {{}|undefined} - Data of the page\n     * @private\n     */\n    _getPageData(pagePath) {\n        if (!this._data) {\n            return;\n        }\n\n        if ('' === pagePath || pagePath === this._data[Constants.PATH_PROP] || pagePath === this.rootPath) {\n            return this._data;\n        }\n\n        return  this._data[Constants.CHILDREN_PROP] && this._data[Constants.CHILDREN_PROP][pagePath];\n    }\n\n    /**\n     * Retrieves the item and eventually returns the data wrapped with the parent information\n     *\n     * @param {string} path                 - Path of the item\n     * @param {{}} [data=_data]             - Data to be explored\n     * @param {{}} [parent]                 - Parent data\n     * @param {string} [parentPath='']      - Path of the parent data\n     * @return {ItemWrapper}\n     * @private\n     */\n    _findItemData(path, data = this._data, parent = undefined, parentPath = '') {\n        let answer = {\n            parent: parent,\n            parentPath: parentPath\n        };\n\n        let items = data[Constants.ITEMS_PROP];\n\n        if (!items) {\n            return answer;\n        }\n\n        for (let pathKey in items) {\n            if (!Object.prototype.hasOwnProperty.call(items, pathKey)) {\n                continue;\n            }\n\n            let childItem = items[pathKey];\n\n            // Direct child. We reached the leaf\n            if (pathKey === path) {\n                answer.data = items[pathKey];\n                answer.key = pathKey;\n                return answer;\n            } else {\n                // Continue traversing\n                let subPath = PathUtils.subpath(path, pathKey);\n                let pageDelimiter = PathUtils._getStartStrings(subPath, this._pageContentDelimiter);\n                let childParentPath = PathUtils.join([parentPath, pathKey, pageDelimiter]);\n                subPath = PathUtils.trimStrings(subPath, this._pageContentDelimiter);\n\n                if (subPath !== path) {\n                    childItem = this._findItemData(subPath, childItem, childItem, childParentPath);\n\n                    if (childItem) {\n                        return childItem;\n                    }\n                }\n            }\n        }\n\n        return answer;\n    }\n\n    /**\n     * Replaces the data in the given location\n     *\n     * @param {string} path     - Path of the data\n     * @param {{}} newData      - New data to be set\n     */\n    setData(path, newData) {\n        let itemKey = PathUtils.getNodeName(path);\n        let data = this.getData(PathUtils.getParentNodePath(path), false);\n\n        if (data && data[Constants.ITEMS_PROP]) {\n            let localData = clone(newData);\n            data[Constants.ITEMS_PROP][itemKey] = localData.value;\n        }\n    }\n\n    /**\n     * Returns the data for the given path. If no path is provided, it returns the whole data\n     *\n     * @param {string} [path]                   - Path to the data\n     * @param {boolean} [immutable=true]        - Should the returned data be a clone\n     * @return {*}\n     */\n    getData(path, immutable = true) {\n        if (!path && typeof path !== 'string') {\n            return immutable ? clone(this._data) : this._data;\n        }\n\n        // Request for the root path\n        // Returns the full data\n        if (path === this._rootPath || path === this._rootPath + '/' + Constants.JCR_CONTENT) {\n            return immutable? clone(this._data) : this._data;\n        }\n\n        const dataPaths = PathUtils.splitPageContentPaths(path);\n\n        let pageData = this._getPageData(dataPaths.pagePath);\n\n        // If there is no page\n        // or if we are getting the data of a page\n        // return the page data\n        if (!pageData || !dataPaths.itemPath) {\n            return immutable? clone(pageData) : pageData;\n        }\n\n        let result = this._findItemData(dataPaths.itemPath, pageData);\n\n        if (result) {\n            return immutable ? clone(result.data) : result.data;\n        }\n    }\n\n    /**\n     * Insert the provided data at the location of the given path. If no sibling name is provided the data is added at the end of the list\n     *\n     * @param {string} path                     - Path to the data\n     * @param {{}} data                         - Data to be inserted\n     * @param {string} [siblingName]            - Name of the item before or after which to add the data\n     * @param {boolean} [insertBefore=false]    - Should the data be inserted before the sibling\n     */\n    insertData(path, data, siblingName, insertBefore = false) {\n        data = clone(data);\n        // We need to find the parent\n        if (!path) {\n            console.warn(\"No path provided for data:\", data);\n            return;\n        }\n\n        const isItem = PathUtils.isItem(path);\n\n        if (!isItem && this._data[Constants.CHILDREN_PROP]) {\n            // Page data\n            this._data[Constants.CHILDREN_PROP][path] = data;\n            return;\n        }\n\n        // Item data\n        const dataPaths = PathUtils.splitPageContentPaths(path);\n        let pageData = this._getPageData(dataPaths.pagePath);\n        let result = this._findItemData(dataPaths.itemPath, pageData);\n        let parent = result.parent || pageData || this._data;\n        let itemName = PathUtils.getNodeName(dataPaths.itemPath);\n\n        if (parent && Object.prototype.hasOwnProperty.call(parent, Constants.ITEMS_PROP)) {\n            parent[Constants.ITEMS_PROP][itemName] = data;\n\n            if (Object.prototype.hasOwnProperty.call(parent, Constants.ITEMS_ORDER_PROP)) {\n                let index = parent[Constants.ITEMS_ORDER_PROP].indexOf(siblingName);\n\n                if (index > -1) {\n                    parent[Constants.ITEMS_ORDER_PROP].splice(insertBefore ? index : index + 1, 0, itemName);\n                } else {\n                    parent[Constants.ITEMS_ORDER_PROP].push(itemName);\n                }\n            }\n        }\n    }\n\n    /**\n     * Removes the data located at the provided location\n     *\n     * @param {string} path         - Path of the data\n     * @return {string|undefined}   - Path to the parent item initially containing the removed data\n     */\n    removeData(path) {\n        if (!path) {\n            return;\n        }\n\n        const isItem = PathUtils.isItem(path);\n\n        if (!isItem && this._data[Constants.CHILDREN_PROP]) {\n            // Page data\n            delete this._data[Constants.CHILDREN_PROP][path];\n            return;\n        }\n\n        // Item data\n        const dataPaths = PathUtils.splitPageContentPaths(path);\n        let pageData = this._getPageData(dataPaths.pagePath);\n        let result = this._findItemData(dataPaths.itemPath, pageData);\n\n        if (result.data) {\n            if (result && result.parent && Object.prototype.hasOwnProperty.call(result.parent, Constants.ITEMS_PROP)) {\n                let { parent } = result;\n                let itemName = PathUtils.getNodeName(dataPaths.itemPath);\n\n                delete parent[Constants.ITEMS_PROP][itemName];\n                delete result.data;\n                delete result.parent;\n\n                if (Object.prototype.hasOwnProperty.call(parent, Constants.ITEMS_ORDER_PROP)) {\n                    let index = parent[Constants.ITEMS_ORDER_PROP].indexOf(itemName);\n                    parent[Constants.ITEMS_ORDER_PROP].splice(index, 1);\n                }\n\n                return result.parentPath;\n            }\n        } else {\n            console.warn(`Item for path ${path} was not found! Nothing to remove then.`);\n        }\n    }\n\n    /**\n     * @private\n     */\n    destroy() {\n        this._data = null;\n        this._rootPath = null;\n        this._pageContentDelimiter = null;\n\n        delete this._data;\n        delete this._rootPath;\n        delete this._pageContentDelimiter;\n    }\n}\n","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\nimport { PathUtils } from \"./PathUtils\";\nimport Constants from \"./Constants\";\nimport MetaProperty from \"./MetaProperty\";\nimport { EditorClient, triggerPageModelLoaded } from \"./EditorClient\";\nimport { ModelClient } from \"./ModelClient\";\nimport { ModelStore } from \"./ModelStore\";\n\n/**\n * Does the provided model object contains an entry for the given child path\n *\n * @param {{}} model            - model to be evaluated\n * @param {string} childPath    - path of the child\n * @return {*}\n *\n * @private\n */\nfunction hasChildOfPath(model, childPath) {\n    return !!(model && childPath && model[Constants.CHILDREN_PROP] && model[Constants.CHILDREN_PROP][PathUtils.sanitize(childPath)]);\n}\n\n/**\n * Does the provided page path correspond to the model root path\n *\n * @param {string} pagePath         - path of the page model\n * @param {string} modelRootPath    - current model root path\n * @return {boolean}\n *\n * @private\n */\nfunction isPageURLRoot(pagePath, modelRootPath) {\n    return !pagePath || !modelRootPath || PathUtils.sanitize(pagePath) === PathUtils.sanitize(modelRootPath);\n}\n\n/**\n * Adapts the provided path to a valid model path.\n * Returns an empty string if the given path is equal to the root model path.\n * This function is a utility tool that converts a provided root model path into an internal specific empty path\n *\n * @param {string} [path]   - raw model path\n * @return {string} the valid model path\n *\n * @private\n */\nfunction adaptPagePath(path) {\n    if (!path) {\n        return '';\n    }\n\n    const localPath = PathUtils.internalize(path);\n\n    if (!this.modelStore || !this.modelStore.rootPath) {\n        return localPath;\n    }\n\n    const localRootModelPath = PathUtils.sanitize(this.modelStore.rootPath);\n\n    return localPath === localRootModelPath ? '' : localPath;\n}\n\n/**\n * Returns the list of provided route filters\n *\n * @returns {string[]}\n *\n * @private\n */\nexport function getRouteFilters() {\n    let routeFilters = PathUtils.getMetaPropertyValue(MetaProperty.PAGE_MODEL_ROUTE_FILTERS);\n    return routeFilters ? routeFilters.split(',') : [];\n}\n\n/**\n * Should the route be excluded\n *\n * @param route\n * @returns {boolean}\n *\n * @private\n */\nexport function isRouteExcluded(route) {\n    const routeFilters = getRouteFilters();\n\n    for (let i = 0, length = routeFilters.length; i < length; i++) {\n        if (new RegExp(routeFilters[i]).test(route)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\n/**\n * The ModelManager gathers all the components implicated in managing the model data\n */\nclass ModelManager {\n\n    /**\n     * Configuration object for the getData function\n     *\n     * @typedef {{}} GetDataConfig\n     * @property {string} path             - Path of the data model\n     * @property {boolean} forceReload     - Should the data model be reloaded\n     */\n\n    /**\n     * Configuration object for the Initialization function\n     *\n     * @typedef {{}} InitializationConfig\n     * @property {string} [path]                   - Path of the data model\n     * @property {{}} [model]                      - Model structure to initialize the page model manager with\n     * @property {ModelClient} [modelClient]       - Model client\n     */\n\n    get modelClient() {\n        return this._modelClient;\n    }\n\n    get modelStore() {\n        return this._modelStore;\n    }\n\n    /**\n     * Verifies the integrity of the provided dependencies\n     *\n     * @return {Promise}\n     * @private\n     */\n    _checkDependencies() {\n        if (!this.modelClient) {\n            return Promise.reject(\"No ModelClient registered\");\n        }\n\n        if (!this.modelStore) {\n            return Promise.reject(\"No ModelManager registered\");\n        }\n\n        return Promise.resolve();\n    }\n\n    /**\n     * Transforms the given path into a model URL\n     *\n     * @param path\n     * @return {*}\n     * @private\n     */\n    _toModelPath(path) {\n        let url = PathUtils.addSelector(path, 'model');\n        url = PathUtils.addExtension(url, 'json');\n        url = PathUtils.externalize(url);\n\n        return PathUtils.makeAbsolute(url);\n    }\n\n    /**\n     * Initializes the ModelManager using the given path to resolve a data model.\n     * If no path is provided, fallbacks are applied in the following order:\n     *\n     * - meta property: cq:pagemodel_root_url\n     * - current pathname of the browser\n     *\n     * Once the initial model is loaded and if the data model doesn't contain the path of the current pathname, the library attempts to fetch a fragment of model.\n     *\n     * @param {string|InitializationConfig} [config]                - URL to the data model or configuration object\n     * @fires cq-pagemodel-loaded\n     * @return {Promise}\n     */\n    initialize(config) {\n        this.destroy();\n        let path;\n        let initialModel;\n\n        if (!config || typeof config === 'string') {\n            path = config;\n        } else if (config) {\n            path = config.path;\n            this._modelClient = config.modelClient;\n            initialModel = config.model;\n        }\n\n        this._listenersMap = {};\n        this._fetchPromises = {};\n        this._initPromise = null;\n\n        const metaPropertyModelUrl = PathUtils.internalize(PathUtils.getMetaPropertyValue(MetaProperty.PAGE_MODEL_ROOT_URL));\n        const currentPathname = PathUtils.sanitize(PathUtils.getCurrentPathname());\n        // Fetch the app root model\n        // 1. consider the provided page path\n        // 2. consider the meta property value\n        // 3. fallback to the model path contained in the URL\n        const rootModelURL = path || metaPropertyModelUrl || currentPathname;\n\n        if (!rootModelURL) {\n            console.error('ModelManager.js', 'Cannot initialize without an URL to fetch the root model');\n        }\n\n        if (!this._modelClient) {\n            this._modelClient = new ModelClient();\n        }\n\n        this._editorClient = new EditorClient(this);\n        this._modelStore = new ModelStore(rootModelURL, initialModel);\n\n        this._initPromise = this._checkDependencies().then(() => {\n            const rootModelPath = PathUtils.sanitize(rootModelURL);\n            let data = this.modelStore.getData(rootModelPath);\n\n            if (data) {\n                triggerPageModelLoaded(data);\n                return data;\n            } else {\n                return this._fetchData(rootModelURL).then((rootModel) => {\n                    this.modelStore.initialize(rootModelPath, rootModel);\n                    // Append the child page if the page model doesn't correspond to the URL of the root model\n                    // and if the model root path doesn't already contain the child model (asynchronous page load)\n                    if (!isRouteExcluded(currentPathname) &&\n                        !isPageURLRoot(currentPathname, metaPropertyModelUrl) &&\n                        !hasChildOfPath(rootModel, currentPathname)) {\n                        return this._fetchData(currentPathname).then((model) => {\n                            this.modelStore.insertData(PathUtils.sanitize(currentPathname), model);\n                            let data = this.modelStore.getData();\n                            triggerPageModelLoaded(data);\n                            return data;\n                        });\n                    } else {\n                        let data = this.modelStore.getData();\n                        triggerPageModelLoaded(data);\n                        return data;\n                    }\n                });\n            }\n        });\n\n        return this._initPromise;\n    }\n\n    /**\n     * Fetches a model for the given path\n     * Consider wrapping this\n     *\n     * @param {string} path - Model path\n     * @return {Promise}\n     * @private\n     */\n    _fetchData(path) {\n        if (Object.prototype.hasOwnProperty.call(this._fetchPromises, path)) {\n            return this._fetchPromises[path];\n        }\n\n        let promise = this.modelClient.fetch(this._toModelPath(path));\n\n        this._fetchPromises[path] = promise;\n\n        promise.then((obj) => {\n            delete this._fetchPromises[path];\n            return obj;\n        }).catch((error) => {\n            delete this._fetchPromises[path];\n            return error;\n        });\n\n        return promise;\n    }\n\n    _storeData(path, data) {\n        const isItem = PathUtils.isItem(path);\n\n        this.modelStore.insertData(path, data);\n\n        // If the path correspond to an item notify either the parent item\n        // Otherwise notify the app root\n        this._notifyListeners(path);\n\n        if (!isItem) {\n            // As we are expecting a page, we notify the root\n            this._notifyListeners('');\n        }\n\n        return data;\n    }\n\n    /**\n     * Returns the path of the data model root\n     *\n     * @return {string}\n     */\n    get rootPath() {\n        return this.modelStore.rootPath;\n    }\n\n    /**\n     * Returns the model for the given configuration\n     * @param {string|GetDataConfig} [config]     - Either the path of the data model or a configuration object. If no parameter is provided the complete model is returned\n     * @return {Promise}\n     */\n    getData(config) {\n        let path;\n        let forceReload = false;\n\n        if (typeof config === 'string') {\n            path = config;\n        } else if (config) {\n            path = config.path;\n            forceReload = config.forceReload;\n        }\n\n        let initPromise = this._initPromise || Promise.resolve();\n\n        return initPromise.then(() => this._checkDependencies())\n            .then(() => {\n                if (!forceReload) {\n                    let item = this.modelStore.getData(path);\n\n                    if (item) {\n                        return Promise.resolve(item);\n                    }\n                }\n\n                // We are not having any items\n                // We want to reload the item\n                return this._fetchData(path).then((data) => this._storeData(path, data));\n            });\n    }\n\n    /**\n     * Notifies the listeners for a given path\n     *\n     * @param {string} path - Path of the data model\n     * @private\n     */\n    _notifyListeners(path) {\n        path = PathUtils.adaptPagePath.call(this, path);\n        let listenersForPath = this._listenersMap[path];\n\n        if (!listenersForPath) {\n            return;\n        }\n\n        if (listenersForPath.length) {\n            listenersForPath.forEach((listener) => {\n                try {\n                    listener();\n                } catch (e) {\n                    console.error('Error in listener ' + listenersForPath + ' at path ' + path + ' : ' + e);\n                }\n            });\n        }\n    }\n\n\n    /**\n     * Add the given callback as a listener for changes at the given path.\n     *\n     * @param {String}  [path]  Absolute path of the resource (e.g., \"/content/mypage\"). If not provided, the root page path is used.\n     * @param {String}  [callback]  Function to be executed listening to changes at given path\n     */\n    addListener(path, callback) {\n        if (!path && typeof path !== 'string') {\n            return;\n        }\n\n        let adaptedPath = adaptPagePath.call(this, path);\n\n        this._listenersMap[adaptedPath] = this._listenersMap[path] || [];\n        this._listenersMap[adaptedPath].push(callback);\n    }\n\n    /**\n     * Remove the callback listener from the given path path.\n     *\n     * @param {String}  [path] Absolute path of the resource (e.g., \"/content/mypage\"). If not provided, the root page path is used.\n     * @param {String}  [callback]  Listener function to be removed.\n     */\n    removeListener(path, callback) {\n        if (!path) {\n            return;\n        }\n        let adaptedPath = adaptPagePath.call(this, path);\n\n        let listenersForPath = this._listenersMap[adaptedPath];\n        if (listenersForPath) {\n            let index = listenersForPath.indexOf(callback);\n            if (index !== -1) {\n                listenersForPath.splice(index, 1);\n            }\n        }\n    }\n\n    /**\n     * @private\n     */\n    destroy() {\n        this._fetchPromises = null;\n        delete this._fetchPromises;\n        this._listenersMap = null;\n        delete this._listenersMap;\n\n        if (this.modelClient && this.modelClient.destroy) {\n            this.modelClient.destroy();\n        }\n\n        if (this.modelStore && this.modelStore.destroy) {\n            this.modelStore.destroy();\n        }\n\n        if (this._editorClient && this._editorClient.destroy) {\n            this._editorClient.destroy();\n        }\n    }\n}\n\nexport default new ModelManager();\n","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/**\n * Type of events triggered or listened by the PageModelManager and ModelRouter\n *\n * @type {{PAGE_MODEL_INIT: string, PAGE_MODEL_LOADED: string, PAGE_MODEL_UPDATE: string, PAGE_MODEL_ROUTE_CHANGED: string}}\n */\nconst EventType = {\n\n    /**\n     * Event which indicates that the PageModelManager has been initialized\n     */\n    PAGE_MODEL_INIT: 'cq-pagemodel-init',\n\n    /**\n     * Event which indicates that the PageModelManager has loaded new content\n     */\n    PAGE_MODEL_LOADED: 'cq-pagemodel-loaded',\n\n    /**\n     * Event that indicates a request to update the page model\n     */\n    PAGE_MODEL_UPDATE: 'cq-pagemodel-update',\n\n    /**\n     * Event which indicates that ModelRouter has identified that model route has changed\n     */\n    PAGE_MODEL_ROUTE_CHANGED: 'cq-pagemodel-route-changed'\n};\n\nexport default EventType;","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\nexport class ModelClient {\n\n    /**\n     * @constructor\n     * @param {string} [apiHost] - Http host of the API\n     */\n    constructor(apiHost) {\n        this._apiHost = apiHost || '';\n        this._fetchPromises = {};\n    }\n\n    /**\n     * Fetches a model using the given a resource path\n     *\n     * @param {string} modelPath - Absolute path to the model.\n     * @return {*}\n     */\n    fetch(modelPath) {\n        if (!modelPath) {\n            let err = 'Fetching model rejected for path: ' + modelPath;\n            return Promise.reject(new Error(err));\n        }\n\n        // Either the API host has been provided or we make an absolute request relative to the current host\n        let url = `${this._apiHost}${modelPath}`;\n        \n        // Assure that the default credentials value ('same-origin') is set for browsers which do not set it\n        // or which are setting the old default value ('omit')\n        return fetch(url, {credentials: 'same-origin'}).then(function(response) {\n            if (response.status >= 200 && response.status < 300) {\n                return response.json();\n            }\n\n            throw { response: response };\n        }).catch((error) => {\n            return Promise.reject(error);\n        });\n    }\n\n    /**\n     * Destroys the internal references to avoid memory leaks\n     */\n    destroy() {\n        this._apiHost = null;\n        this._fetchPromises = null;\n    }\n}","// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,\n// backported and transplited with Babel, with backwards-compat fixes\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  if (path.length === 0) return '.';\n  var code = path.charCodeAt(0);\n  var hasRoot = code === 47 /*/*/;\n  var end = -1;\n  var matchedSlash = true;\n  for (var i = path.length - 1; i >= 1; --i) {\n    code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) return hasRoot ? '/' : '.';\n  if (hasRoot && end === 1) {\n    // return '//';\n    // Backwards-compat fix:\n    return '/';\n  }\n  return path.slice(0, end);\n};\n\nfunction basename(path) {\n  if (typeof path !== 'string') path = path + '';\n\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  for (i = path.length - 1; i >= 0; --i) {\n    if (path.charCodeAt(i) === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // path component\n      matchedSlash = false;\n      end = i + 1;\n    }\n  }\n\n  if (end === -1) return '';\n  return path.slice(start, end);\n}\n\n// Uses a mixed approach for backwards-compatibility, as ext behavior changed\n// in new Node.js versions, so only basename() above is backported here\nexports.basename = function (path, ext) {\n  var f = basename(path);\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\nexports.extname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true;\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n  var preDotState = 0;\n  for (var i = path.length - 1; i >= 0; --i) {\n    var code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n    if (code === 46 /*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 ||\n      // We saw a non-dot character immediately before the dot\n      preDotState === 0 ||\n      // The (right-most) trimmed path component is exactly '..'\n      preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n  return path.slice(startDot, end);\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n","module.exports = require(\"url\");","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\nrequire('./src/ModelRouter');\n\nexport { default as ModelManager } from \"./src/ModelManager\";\nexport * from \"./src/ModelClient\";\nexport * from \"./src/PathUtils\";\nexport { default as Constants } from \"./src/Constants\";","/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2018 Adobe Systems Incorporated\n * All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and may be covered by U.S. and Foreign Patents,\n * patents in process, and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\nimport EventType from './EventType';\nimport { PathUtils } from \"./PathUtils\";\nimport MetaProperty from \"./MetaProperty\";\nimport ModelManagerSerice from \"./ModelManager\";\nimport { isRouteExcluded } from \"./ModelManager\";\n\n/**\n * Triggered by the ModelRouter when the route has changed.\n *\n * @event cq-pagemodel-route-changed\n * @type {Object}\n * @property {Object} detail\n * @property {Object} detail.model - The page model object corresponding to the new route\n */\n\n/**\n * <p>The ModelRouter listens for HTML5 History API <i>popstate</i> events and calls {@link PageModelManager#getData()} with the model path it extracted from the URL.</p>\n *\n * <h2>Configuration</h2>\n *\n * <p>The Model Router can be configured using meta properties located in the head section of the document.</p>\n *\n * <h3>Meta properties</h3>\n * <ul>\n *     <li>cq:page_model_router - default=undefined, options=disable</li>\n *     <li>cq:page_model_route_filters - default=undefined, options=RegExp<></li>\n * </ul>\n *\n * <h3>Defaults</h3>\n * <ul>\n *     <li>The ModelRouter is enabled and uses the <i>History</i> API to extract the model path from the current content path</li>\n * </ul>\n *\n * <h3>Examples and Usages</h3>\n *\n * <h4>Disables the page model router</h4>\n * <pre>\n *     <code>e.g. &lt;meta property=\"cq:page_model_router\" content=\"disable\"\\&gt;</code>\n * </pre>\n *\n * <h4>Filters paths from the model routing with the given patterns</h4>\n * <pre>\n *     <code>e.g. &lt;meta property=\"cq:page_model_route_filters\" content=\"route/not/found,^(.*)(?:exclude/path)(.*)\"\\&gt;</code>\n * </pre>\n *\n * @module ModelRouter\n */\n\n/**\n * Modes in which the Model Router operates\n *\n * @type {{DISABLED: string, CONTENT_PATH: string}}\n */\nexport const ROUTER_MODES = {\n\n    /**\n     * Flag that indicates that the model router should be disabled\n     *\n     * @type {string}\n     */\n    DISABLED: 'disabled',\n\n    /**\n     * Flag that indicates that the model router should extract the model path from the content path section of the URL\n     *\n     * @type {string}\n     */\n    CONTENT_PATH: 'path'\n};\n\n/**\n * Returns the model path. If no URL is provided the current window URL is used\n *\n * @param {string} [url]    - url from which to extract the model path\n *\n * @return {string}\n */\nexport function getModelPath(url) {\n    let localUrl;\n\n    localUrl = url || window.location.pathname;\n\n    // The default value model path comes as the the content path\n    let endPosition = localUrl.indexOf('.');\n\n    if (endPosition < 0) {\n\n        //If the path is missing extension and has query params instead eg. http://zyx/abc?test=test\n        let queryPosition = localUrl.indexOf('?');\n        if (queryPosition < 0)\n            endPosition = localUrl.length;\n        else\n            endPosition = queryPosition;\n    }\n\n    return localUrl.substr(0, endPosition);\n}\n\n/**\n * Is the model router enabled. Enabled by default\n * @returns {boolean}\n *\n * @private\n */\nexport function isModelRouterEnabled() {\n    if (!PathUtils.isBrowser()) {\n        return false;\n    }\n    const modelRouterMetaType = PathUtils.getMetaPropertyValue(MetaProperty.PAGE_MODEL_ROUTER);\n    // Enable the the page model routing by default\n    return !modelRouterMetaType || ROUTER_MODES.DISABLED !== modelRouterMetaType;\n}\n\n/**\n * Fetches the model from the PageModelManager and then dispatches it\n *\n * @fires cq-pagemodel-route-changed\n *\n * @param {string} [path]   - path of the model to be dispatched\n *\n * @private\n */\nexport function dispatchRouteChanged(path) {\n    // Triggering the page model manager to load a new child page model\n    // No need to use a cache as the PageModelManager already does it\n    ModelManagerSerice.getData({path: path}).then(function (model) {\n        PathUtils.dispatchGlobalCustomEvent(EventType.PAGE_MODEL_ROUTE_CHANGED, {\n            detail: {\n                model: model\n            }\n        });\n    });\n}\n\n/**\n * Triggers the PageModelManager to fetch data based on the current route\n *\n * @fires cq-pagemodel-route-changed - with the root page model object\n *\n * @param {string} [url]    - url from which to extract the model path\n *\n * @private\n */\nexport function routeModel(url) {\n    if (!isModelRouterEnabled()) {\n        return;\n    }\n\n    const path = getModelPath(url);\n\n\n    // don't fetch the model\n    // for the root path\n    // or when the route is excluded\n    if (!path || '/' === path || isRouteExcluded(path)) {\n        return;\n    }\n\n    dispatchRouteChanged(path);\n}\n\n// Activate the model router\nif (isModelRouterEnabled()) {\n    // Encapsulate the history.pushState and history.replaceState functions to prefetch the page model for the current route\n    const pushState = window.history.pushState;\n    const replaceState = window.history.replaceState;\n\n    window.history.pushState = function(state, title, url) {\n        routeModel(url);\n\n        return pushState.apply(history, arguments);\n    };\n\n    window.history.replaceState = function(state, title, url) {\n        routeModel(url);\n\n        return replaceState.apply(history, arguments);\n    };\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}