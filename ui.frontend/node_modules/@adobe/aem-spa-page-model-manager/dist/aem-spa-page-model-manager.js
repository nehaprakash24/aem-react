!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cqSpaPageModelManager=e():t.cqSpaPageModelManager=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=10)}([function(t,e,r){"use strict";r.d(e,"a",(function(){return d}));var n=r(8),i=r(9),o=r.n(i),a=r(1);class s{constructor(){}}s.DEFAULT_SLING_MODEL_SELECTOR="model",s.DEFAULT_MODEL_JSON_EXTENSION=".model.json";var l=s,c=r(3);const h=/(?:\/)(?:content|apps|libs|etc|etc.clientlibs|conf|mnt\/overlay)(?:\/)/,u="(.+)/"+a.a.JCR_CONTENT+"/(.+)";class d{static isBrowser(){try{return"undefined"!=typeof window}catch(t){return!1}}static getContextPath(t){const e=t||this.getCurrentPathname();if(!e)return"";const r=e.match(h),n=null===r?-1:r.index||-1;return n>0?e.slice(0,n):""}static adaptPagePath(t,e){if(!t)return"";if(!e)return t;const r=d.internalize(t);return r===d.sanitize(e)?"":r}static externalize(t){const e=this.getContextPath();return t.startsWith(e)?t:`${e}${t}`}static internalize(t){if(!t||"string"!=typeof t)return"";const e=this.getContextPath();return t.replace(new RegExp(`^${e}/`),"/")}static getMetaPropertyValue(t){let e=null;if(this.isBrowser()){const r=document.head.querySelector(`meta[property="${t}"]`);e=r?r.getAttribute("content"):null}return e}static convertToModelUrl(t){return t&&t.replace&&t.replace(/\.htm(l)?$/,l.DEFAULT_MODEL_JSON_EXTENSION)}static getCurrentPageModelUrl(){const t=this.getCurrentPathname();let e=null;return t&&(e=this.convertToModelUrl(t)||null),e}static getModelUrl(t){if(t&&t.replace)return this.convertToModelUrl(t);const e=this.getMetaPropertyValue(c.a.PAGE_MODEL_ROOT_URL);return e||this.getCurrentPageModelUrl()}static sanitize(t){if(!t||"string"!=typeof t)return;let e=o.a.parse(t,!1,!0).pathname;if(e){e=this.internalize(e);const t=e.indexOf(".");t>-1&&(e=e.substr(0,t)),e=Object(n.normalize)(e)}return e}static addExtension(t,e){if(!e||e.length<1)return t;if(e.startsWith(".")||(e="."+e),!t||t.length<1||t.indexOf(e)>-1)return t;let r=t;const n=/^((?:[/a-zA-Z0-9:_-]*)+)(?:\.?)([a-zA-Z0-9._-]*)(?:\/?)([a-zA-Z0-9/._-]*)(?:\??)([a-zA-Z0-9=&]*)$/g.exec(t);let i="";return n&&n.length>2&&(i=n[3]?"/"+n[3]:"",i+=n[4]?"?"+n[4]:"",r=n[1]+"."+n[2].replace(/\.htm(l)?/,e)+i),r.indexOf(e)>-1?r:r+e+i}static addSelector(t,e){if(!e||e.length<1)return t;if(e.startsWith(".")||(e="."+e),!t||t.length<1||t.indexOf(e)>-1)return t;const r=t.indexOf(".")||t.length;return r<0?t+e:t.slice(0,r)+e+t.slice(r,t.length)}static getCurrentPathname(){return this.isBrowser()?window.location.pathname:null}static dispatchGlobalCustomEvent(t,e){this.isBrowser()&&window.dispatchEvent(new CustomEvent(t,e))}static join(t){return t?this.normalize(t.filter(t=>t).join("/")):""}static normalize(t){return t?t.replace(/\/+/g,"/"):""}static makeAbsolute(t){return t&&"string"==typeof t?t.startsWith("/")?t:"/"+t:""}static makeRelative(t){return t&&"string"==typeof t?t.startsWith("/")?t.slice(1):t:""}static getParentNodePath(t){if(t&&t.length>0){const e=t.lastIndexOf("/")+1;if(e<t.length)return t.substring(0,e-1)}return null}static isItem(t){return new RegExp(u).test(t)}static getNodeName(t){return("string"==typeof t?t.replace(/\/+/g,"/").split(/\//).filter(Boolean):[]).pop()||null}static subpath(t,e){if(!t)return"";const r=d.makeRelative(t).split("/"),n=d.makeRelative(e).split("/");if(r.length<n.length)return t;let i;for(i=0;i<n.length&&r[i]===n[i];++i);return i===n.length?r.slice(i).join("/"):t}static splitByDelimitators(t,e){let r=[t];return e.forEach(t=>{let e=[];const n=d.normalize(d.makeAbsolute(t)+"/");r.forEach(r=>{if(e=e.concat(r.split(n)),r.endsWith(t)){const r=e.splice(e.length-1,1)[0];r!==t&&(e=e.concat(r.split(d.makeAbsolute(t))))}e=e.filter(t=>t)}),r=e}),r}static _getJCRPath(t,e){return[t,a.a.JCR_CONTENT,e].join("/")}static splitPageContentPaths(t){if(!t&&"string"!=typeof t)return;const e=t.split(`/${a.a.JCR_CONTENT}/`),r={pagePath:e[0]};return e.length>1&&(r.itemPath=e[1]),r}static trimStrings(t,e){return e.forEach(e=>{for(;t.startsWith(e);)t=d.makeRelative(t.slice(e.length));for(;t.endsWith(e);)(t=t.slice(0,t.length-e.length)).endsWith("/")&&(t=t.slice(0,t.length-1))}),t}static _getStartStrings(t,e){let r="";return e.forEach(e=>{for(;t.startsWith(e);)t=d.makeRelative(t.slice(e.length)),r=`${r}/${e}`}),d.makeRelative(r)}}},function(t,e,r){"use strict";class n{constructor(){}}n.TYPE_PROP=":type",n.ITEMS_PROP=":items",n.ITEMS_ORDER_PROP=":itemsOrder",n.PATH_PROP=":path",n.CHILDREN_PROP=":children",n.HIERARCHY_TYPE_PROP=":hierarchyType",n.JCR_CONTENT="jcr:content",e.a=n},function(t,e){t.exports=require("clone")},function(t,e,r){"use strict";class n{constructor(){}}n.PAGE_MODEL_ROOT_URL="cq:pagemodel_root_url",n.PAGE_MODEL_ROUTE_FILTERS="cq:pagemodel_route_filters",n.PAGE_MODEL_ROUTER="cq:pagemodel_router",e.a=n},function(t,e,r){"use strict";class n{constructor(){}}n.PAGE_MODEL_INIT="cq-pagemodel-init",n.PAGE_MODEL_LOADED="cq-pagemodel-loaded",n.PAGE_MODEL_UPDATE="cq-pagemodel-update",n.PAGE_MODEL_ROUTE_CHANGED="cq-pagemodel-route-changed",e.a=n},function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));class n{constructor(t){this._apiHost=t||"",this._fetchPromises={}}fetch(t){if(!t){const e="Fetching model rejected for path: "+t;return Promise.reject(new Error(e))}const e=this._apiHost||"";return fetch(`${e}${t}`,{credentials:"same-origin"}).then(t=>{if(t.status>=200&&t.status<300)return t.json();throw{response:t}}).catch(t=>Promise.reject(t))}destroy(){this._apiHost=null,this._fetchPromises=null}}},function(t,e,r){"use strict";var n=r(1),i=r(2),o=r.n(i),a=r(4),s=r(0);function l(t){s.a.dispatchGlobalCustomEvent(a.a.PAGE_MODEL_LOADED,{detail:{model:o()(t)}})}class c{constructor(t){this._modelManager=t,this._windowListener=t=>{t&&t.detail&&t.detail.msg?this._updateModel(t.detail.msg):console.error("EditorService.js","No message passed to cq-pagemodel-update",t)},s.a.isBrowser()&&window.addEventListener(a.a.PAGE_MODEL_UPDATE,this._windowListener)}_updateModel(t){if(!t||!t.cmd||!t.path)return void console.error("PageModelManager.js","Not enough data received to update the page model");const e=t.path,r=t.cmd,n=o()(t.data);let i,a,c;const h=s.a.getParentNodePath(e);switch(r){case"replace":this._modelManager.modelStore.setData(e,n),this._modelManager._notifyListeners(e);break;case"delete":this._modelManager.modelStore.removeData(e),h&&this._modelManager._notifyListeners(h);break;case"insertBefore":c=!0;case"insertAfter":i=s.a.getNodeName(e),h&&(a=h+"/"+n.key,this._modelManager.modelStore.insertData(a,n.value,i,c),this._modelManager._notifyListeners(h));break;default:console.log("EditorClient","unsupported command:",r)}l(this._modelManager.modelStore.dataMap)}destroy(){delete this._modelManager,s.a.isBrowser()&&window.removeEventListener(a.a.PAGE_MODEL_UPDATE,this._windowListener)}}var h=r(3),u=r(5);class d{constructor(t,e){this._data=null,this._rootPath=null,this.initialize(t,e||{}),this._pageContentDelimiter=[n.a.JCR_CONTENT]}initialize(t,e){e&&(this._data=e),this._rootPath=t}get rootPath(){return this._rootPath||""}get dataMap(){return this._data}setData(t,e={}){const r=s.a.getNodeName(t);if(r){const i=this.getData(s.a.getParentNodePath(t),!1);if(i&&i[n.a.ITEMS_PROP]){const t=o()(e),a=i[n.a.ITEMS_PROP]||{};a[r]=t.value,i[n.a.ITEMS_PROP]=a}}}getData(t,e=!0){if(!t&&"string"!=typeof t)return e?o()(this._data):this._data;if(t===this._rootPath||t===`${this._rootPath}/${n.a.JCR_CONTENT}`)return e?o()(this._data):this._data;const r=s.a.splitPageContentPaths(t);if(r){const t=this._getPageData(r.pagePath);if(!t||!r.itemPath)return e?o()(t):t;const n=this._findItemData(r.itemPath,t);if(n)return e?o()(n.data):n.data}}insertData(t,e,r,i=!1){if(e=o()(e),!t)return void console.warn("No path provided for data: "+e);if(!s.a.isItem(t)&&this._data&&this._data[n.a.CHILDREN_PROP])return void(this._data[n.a.CHILDREN_PROP][t]=e);const a=s.a.splitPageContentPaths(t);if(a&&a.itemPath){const t=this._getPageData(a.pagePath),o=this._findItemData(a.itemPath,t).parent||t||this._data,l=s.a.getNodeName(a.itemPath);if(null!=l&&o&&Object.prototype.hasOwnProperty.call(o,n.a.ITEMS_PROP)){const t=o[n.a.ITEMS_PROP];if(t){t[l]=e;const a=o[n.a.ITEMS_ORDER_PROP];if(null!=a&&a.length>0&&null!=r){const t=a.indexOf(r);t>-1?a.splice(i?t:t+1,0,l):a.push(l)}}}}}removeData(t){if(!t)return null;if(!s.a.isItem(t)&&this._data&&this._data[n.a.CHILDREN_PROP])return delete this._data[n.a.CHILDREN_PROP][t],null;const e=s.a.splitPageContentPaths(t);if(e&&e.itemPath){const t=this._getPageData(e.pagePath),r=this._findItemData(e.itemPath,t);if(r.data&&r&&r.parent&&Object.prototype.hasOwnProperty.call(r.parent,n.a.ITEMS_PROP)){const{parent:t}=r,i=t[n.a.ITEMS_PROP],o=s.a.getNodeName(e.itemPath);if(o){i&&delete i[o],delete r.data,delete r.parent;const e=t[n.a.ITEMS_ORDER_PROP];if(e&&e.length>0){const t=e.indexOf(o);e.splice(t,1)}return r.parentPath?r.parentPath:null}}}return console.warn(`Item for path ${t} was not found! Nothing to remove then.`),null}destroy(){this._data=null,this._rootPath=null,this._pageContentDelimiter=null,delete this._data,delete this._rootPath,delete this._pageContentDelimiter}_findItemData(t,e=this._data,r=null,i=""){const o={parent:r,parentPath:i};if(!e)throw new Error("Assertion error: No data provided. This should never happen.");const a=e[n.a.ITEMS_PROP];if(!a)return o;for(const e in a){if(!Object.prototype.hasOwnProperty.call(a,e))continue;const r=a[e];if(e===t)return o.data=a[e],o.key=e,o;{let n=s.a.subpath(t,e);if(!this._pageContentDelimiter)throw new Error("_pageContentDelimiter not set. this should never happen as its set in constructor.");{const o=s.a._getStartStrings(n,this._pageContentDelimiter),a=s.a.join([i,e,o]);if(n=s.a.trimStrings(n,this._pageContentDelimiter),n!==t){const t=this._findItemData(n,r,r,a);if(t)return t}}}}return o}_getPageData(t){if(!this._data)return;if(""===t||t===this._data[n.a.PATH_PROP]||t===this.rootPath)return this._data;const e=this._data[n.a.CHILDREN_PROP];return e&&e[t]}}e.a=new class{constructor(){this._listenersMap={},this._fetchPromises={}}get modelClient(){if(!this._modelClient)throw new Error("ModelClient is undefined. Call initialize first!");return this._modelClient}get modelStore(){if(!this._modelStore)throw new Error("ModelStore is undefined. Call initialize first!");return this._modelStore}initialize(t){let e;this.destroy();let r=null;t&&"string"!=typeof t?t&&(e=t.path,this._modelClient=t.modelClient,r=t.model):e=t,this._listenersMap={},this._fetchPromises={},this._initPromise=null;const i=s.a.getMetaPropertyValue(h.a.PAGE_MODEL_ROOT_URL),o=s.a.internalize(i),a=s.a.getCurrentPathname(),f=a?s.a.sanitize(a):"",p=e||o||f;if(!p)throw new Error("ModelManager.js Cannot initialize without an URL to fetch the root model");return this._modelClient||(this._modelClient=new u.a),this._editorClient=new c(this),this._modelStore=r?new d(p,r):new d(p),this._initPromise=this._checkDependencies().then(()=>{const t=s.a.sanitize(p);if(!t)throw new Error("No root modelpath resolved! This should never happen.");const e=this.modelStore.getData(t);return e&&Object.keys(e).length>0?(l(e),e):this._fetchData(p).then(e=>{if(this.modelStore.initialize(t,e),a&&f){if(i=o,(r=a)&&i&&s.a.sanitize(r)!==s.a.sanitize(i)&&!function(t,e){const r=s.a.sanitize(e);return!!r&&!!(t&&e&&t[n.a.CHILDREN_PROP]&&t[n.a.CHILDREN_PROP][r])}(e,a))return this._fetchData(a).then(t=>{this.modelStore.insertData(f,t);const e=this.modelStore.getData();return l(e),e});{const t=this.modelStore.getData();return l(t),t}}throw new Error("Attempting to retrieve model data from a non-browser. Please provide the initial data with the property key model");var r,i})}),this._initPromise}get rootPath(){return this.modelStore.rootPath}getData(t){let e,r=!1;"string"==typeof t?e=t:t?(e=t.path||"",r=!!t.forceReload||!1):e="";return(this._initPromise||Promise.resolve()).then(()=>this._checkDependencies()).then(()=>{if(!r){const t=this.modelStore.getData(e);if(t)return Promise.resolve(t)}return this._fetchData(e).then(t=>this._storeData(e,t))})}_fetchData(t){if(Object.prototype.hasOwnProperty.call(this._fetchPromises,t))return this._fetchPromises[t];if(this.modelClient){const e=this.modelClient.fetch(this._toModelPath(t));return this._fetchPromises[t]=e,e.then(e=>(delete this._fetchPromises[t],e)).catch(e=>(delete this._fetchPromises[t],e)),e}throw new Error("ModelClient not initialized!")}_notifyListeners(t){if(t=s.a.adaptPagePath.call(this,t),!this._listenersMap)throw new Error("ListenersMap is undefined.");const e=this._listenersMap[t];e&&e.length&&e.forEach(r=>{try{r()}catch(r){console.error(`Error in listener ${e} at path ${t}: ${r}`)}})}addListener(t,e){if(!this._listenersMap)throw new Error("ListenersMap is undefined.");if(!t&&"string"!=typeof t)return;const r=this.adaptPagePath(t);this._listenersMap[r]=this._listenersMap[t]||[],this._listenersMap[r].push(e)}removeListener(t,e){if(!this._listenersMap)throw new Error("ListenersMap is undefined.");if(!t)return;const r=this.adaptPagePath(t),n=this._listenersMap[r];if(n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}adaptPagePath(t){if(!t)return"";const e=s.a.internalize(t);if(!this.modelStore||!this.modelStore.rootPath)return e;return e===s.a.sanitize(this.modelStore.rootPath)?"":e}destroy(){delete this._fetchPromises,delete this._listenersMap,this._modelClient&&this._modelClient.destroy&&this._modelClient.destroy(),this._modelStore&&this._modelStore.destroy&&this._modelStore.destroy(),this._editorClient&&this._editorClient.destroy&&this._editorClient.destroy()}_storeData(t,e){let r=!1;return this._modelStore&&(r=s.a.isItem(t)),this.modelStore.insertData(t,e),this._notifyListeners(t),r||this._notifyListeners(""),e}_toModelPath(t){let e=s.a.addSelector(t,"model");return e=s.a.addExtension(e,"json"),e=s.a.externalize(e),s.a.makeAbsolute(e)}_checkDependencies(){return this.modelClient?this.modelStore?Promise.resolve():Promise.reject("No ModelManager registered."):Promise.reject("No ModelClient registered.")}}},function(t,e){},function(t,e,r){(function(t){function r(t,e){for(var r=0,n=t.length-1;n>=0;n--){var i=t[n];"."===i?t.splice(n,1):".."===i?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r}e.resolve=function(){for(var e="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a=o>=0?arguments[o]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,i="/"===a.charAt(0))}return(i?"/":"")+(e=r(n(e.split("/"),(function(t){return!!t})),!i).join("/"))||"."},e.normalize=function(t){var o=e.isAbsolute(t),a="/"===i(t,-1);return(t=r(n(t.split("/"),(function(t){return!!t})),!o).join("/"))||o||(t="."),t&&a&&(t+="/"),(o?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(n(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))},e.relative=function(t,r){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=e.resolve(t).substr(1),r=e.resolve(r).substr(1);for(var i=n(t.split("/")),o=n(r.split("/")),a=Math.min(i.length,o.length),s=a,l=0;l<a;l++)if(i[l]!==o[l]){s=l;break}var c=[];for(l=s;l<i.length;l++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),r=47===e,n=-1,i=!0,o=t.length-1;o>=1;--o)if(47===(e=t.charCodeAt(o))){if(!i){n=o;break}}else i=!1;return-1===n?r?"/":".":r&&1===n?"/":t.slice(0,n)},e.basename=function(t,e){var r=function(t){"string"!=typeof t&&(t+="");var e,r=0,n=-1,i=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!i){r=e+1;break}}else-1===n&&(i=!1,n=e+1);return-1===n?"":t.slice(r,n)}(t);return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},e.extname=function(t){"string"!=typeof t&&(t+="");for(var e=-1,r=0,n=-1,i=!0,o=0,a=t.length-1;a>=0;--a){var s=t.charCodeAt(a);if(47!==s)-1===n&&(i=!1,n=a+1),46===s?-1===e?e=a:1!==o&&(o=1):-1!==e&&(o=-1);else if(!i){r=a+1;break}}return-1===e||-1===n||0===o||1===o&&e===n-1&&e===r+1?"":t.slice(e,n)};var i="b"==="ab".substr(-1)?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return e<0&&(e=t.length+e),t.substr(e,r)}}).call(this,r(12))},function(t,e){t.exports=require("url")},function(t,e,r){"use strict";r.r(e);r(11);var n=r(6);r.d(e,"ModelManager",(function(){return n.a}));var i=r(7);for(var o in i)["default","ModelManager","Constants"].indexOf(o)<0&&function(t){r.d(e,t,(function(){return i[t]}))}(o);var a=r(5);r.d(e,"ModelClient",(function(){return a.a}));var s=r(0);r.d(e,"PathUtils",(function(){return s.a}));var l=r(1);r.d(e,"Constants",(function(){return l.a}))},function(t,e,r){"use strict";var n=r(4),i=r(3),o=r(6),a=r(0);class s{constructor(){}}function l(t){const e=function(){const t=a.a.getMetaPropertyValue(i.a.PAGE_MODEL_ROUTE_FILTERS);return t?t.split(","):[]}();for(let r=0,n=e.length;r<n;r++)if(new RegExp(e[r]).test(t))return!0;return!1}function c(){if(!a.a.isBrowser())return!1;const t=a.a.getMetaPropertyValue(i.a.PAGE_MODEL_ROUTER);return!t||s.DISABLED!==t}function h(t){if(!c())return;const e=function(t){const e=t||window.location.pathname;let r=e.indexOf(".");if(r<0){const t=e.indexOf("?");r=t<0?e.length:t}return e.substr(0,r)}(t);e&&"/"!==e&&!l(e)&&function(t){o.a.getData({path:t}).then(t=>{a.a.dispatchGlobalCustomEvent(n.a.PAGE_MODEL_ROUTE_CHANGED,{detail:{model:t}})})}(e)}if(s.DISABLED="disabled",s.CONTENT_PATH="path",c()){const t=window.history.pushState,e=window.history.replaceState;window.history.pushState=(e,r,n)=>(h(n||null),t.apply(history,[e,r,n])),window.history.replaceState=(t,r,n)=>(h(n||null),e.apply(history,[t,r,n]))}},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var l,c=[],h=!1,u=-1;function d(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&f())}function f(){if(!h){var t=s(d);h=!0;for(var e=c.length;e;){for(l=c,c=[];++u<e;)l&&l[u].run();u=-1,e=c.length}l=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function _(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new p(t,e)),1!==c.length||h||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=_,i.addListener=_,i.once=_,i.off=_,i.removeListener=_,i.removeAllListeners=_,i.emit=_,i.prependListener=_,i.prependOnceListener=_,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}])}));