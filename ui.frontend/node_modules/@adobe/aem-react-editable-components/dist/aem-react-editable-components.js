!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cqReactEditableComponents=e():t.cqReactEditableComponents=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e){t.exports=require("react")},function(t,e){t.exports=require("prop-types")},function(t,e){t.exports=require("@adobe/aem-spa-page-model-manager")},function(t,e){t.exports=require("@adobe/aem-spa-component-mapping")},function(t,e,n){"use strict";var r=Array.isArray,o=Object.keys,s=Object.prototype.hasOwnProperty,a="undefined"!=typeof Element;t.exports=function(t,e){try{return function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var i,p,c,l=r(e),u=r(n);if(l&&u){if((p=e.length)!=n.length)return!1;for(i=p;0!=i--;)if(!t(e[i],n[i]))return!1;return!0}if(l!=u)return!1;var h=e instanceof Date,m=n instanceof Date;if(h!=m)return!1;if(h&&m)return e.getTime()==n.getTime();var d=e instanceof RegExp,f=n instanceof RegExp;if(d!=f)return!1;if(d&&f)return e.toString()==n.toString();var g=o(e);if((p=g.length)!==o(n).length)return!1;for(i=p;0!=i--;)if(!s.call(n,g[i]))return!1;if(a&&e instanceof Element&&n instanceof Element)return e===n;for(i=p;0!=i--;)if(!("_owner"===(c=g[i])&&e.$$typeof||t(e[c],n[c])))return!1;return!0}return e!=e&&n!=n}(t,e)}catch(t){if(t.message&&t.message.match(/stack|recursion/i)||-2146828260===t.number)return console.warn("Warning: react-fast-compare does not handle circular references.",t.name,t.message),!1;throw t}}},function(t,e,n){(function(t){function n(t,e){for(var n=0,r=t.length-1;r>=0;r--){var o=t[r];"."===o?t.splice(r,1):".."===o?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function r(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}e.resolve=function(){for(var e="",o=!1,s=arguments.length-1;s>=-1&&!o;s--){var a=s>=0?arguments[s]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,o="/"===a.charAt(0))}return(o?"/":"")+(e=n(r(e.split("/"),(function(t){return!!t})),!o).join("/"))||"."},e.normalize=function(t){var s=e.isAbsolute(t),a="/"===o(t,-1);return(t=n(r(t.split("/"),(function(t){return!!t})),!s).join("/"))||s||(t="."),t&&a&&(t+="/"),(s?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(r(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))},e.relative=function(t,n){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var o=r(t.split("/")),s=r(n.split("/")),a=Math.min(o.length,s.length),i=a,p=0;p<a;p++)if(o[p]!==s[p]){i=p;break}var c=[];for(p=i;p<o.length;p++)c.push("..");return(c=c.concat(s.slice(i))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),n=47===e,r=-1,o=!0,s=t.length-1;s>=1;--s)if(47===(e=t.charCodeAt(s))){if(!o){r=s;break}}else o=!1;return-1===r?n?"/":".":n&&1===r?"/":t.slice(0,r)},e.basename=function(t,e){var n=function(t){"string"!=typeof t&&(t+="");var e,n=0,r=-1,o=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!o){n=e+1;break}}else-1===r&&(o=!1,r=e+1);return-1===r?"":t.slice(n,r)}(t);return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){"string"!=typeof t&&(t+="");for(var e=-1,n=0,r=-1,o=!0,s=0,a=t.length-1;a>=0;--a){var i=t.charCodeAt(a);if(47!==i)-1===r&&(o=!1,r=a+1),46===i?-1===e?e=a:1!==s&&(s=1):-1!==e&&(s=-1);else if(!o){n=a+1;break}}return-1===e||-1===r||0===s||1===s&&e===r-1&&e===n+1?"":t.slice(e,r)};var o="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,n(6))},function(t,e){var n,r,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function i(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var p,c=[],l=!1,u=-1;function h(){l&&p&&(l=!1,p.length?c=p.concat(c):u=-1,c.length&&m())}function m(){if(!l){var t=i(h);l=!0;for(var e=c.length;e;){for(p=c,c=[];++u<e;)p&&p[u].run();u=-1,e=c.length}p=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function f(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||l||i(m)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e,n){"use strict";n.r(e),n.d(e,"ComponentMapping",(function(){return s.ComponentMapping})),n.d(e,"MapTo",(function(){return q})),n.d(e,"ComponentMappingContext",(function(){return O})),n.d(e,"withComponentMappingContext",(function(){return I})),n.d(e,"AllowedComponentsContainer",(function(){return N})),n.d(e,"Container",(function(){return M})),n.d(e,"withEditable",(function(){return m})),n.d(e,"PLACEHOLDER_CLASS_NAME",(function(){return u})),n.d(e,"ModelProvider",(function(){return C})),n.d(e,"withModel",(function(){return E})),n.d(e,"Page",(function(){return S})),n.d(e,"ResponsiveGrid",(function(){return L})),n.d(e,"EditorContext",(function(){return y})),n.d(e,"withEditorContext",(function(){return b})),n.d(e,"Utils",(function(){return P}));var r=n(0),o=n.n(r),s=n(3),a=n(4),i=n.n(a),p=n(2);class c{constructor(){}}c.DATA_PATH_ATTR="data-cq-data-path",c.NEW_SECTION_CLASS_NAMES="new section",c.TYPE_PROP=p.Constants.TYPE_PROP,c.ITEMS_PROP=p.Constants.ITEMS_PROP,c.ITEMS_ORDER_PROP=p.Constants.ITEMS_ORDER_PROP,c.PATH_PROP=p.Constants.PATH_PROP,c.CHILDREN_PROP=p.Constants.CHILDREN_PROP,c.HIERARCHY_TYPE_PROP=p.Constants.HIERARCHY_TYPE_PROP;var l=c;const u="cq-placeholder";class h extends r.Component{constructor(t){super(t),this.state=this.propsToState(t)}propsToState(t){const{wrappedComponent:e,containerProps:n,editConfig:r,...o}=t;return o}componentDidUpdate(t){i()(t,this.props)||this.setState(this.propsToState(this.props))}get editProps(){const t={};return this.props.componentProperties.isInEditor?(t[l.DATA_PATH_ATTR]=this.props.componentProperties.cqPath,t):t}get emptyPlaceholderProps(){return this.useEmptyPlaceholder()?{className:u,"data-emptytext":this.props.editConfig.emptyLabel}:null}useEmptyPlaceholder(){return this.props.componentProperties.isInEditor&&"function"==typeof this.props.editConfig.isEmpty&&this.props.editConfig.isEmpty(this.props.componentProperties)}render(){const t=this.props.wrappedComponent;return o.a.createElement("div",Object.assign({},this.editProps,this.props.containerProps),o.a.createElement(t,Object.assign({},this.state)),o.a.createElement("div",Object.assign({},this.emptyPlaceholderProps)))}}function m(t,e){const n=e||{isEmpty:t=>!1};return class extends r.Component{render(){const e={...this.props,componentProperties:this.props,editConfig:n,wrappedComponent:t};return o.a.createElement(h,Object.assign({},e))}}}var d=n(5);Error;var f;function g(){if(function(){try{return"undefined"!=typeof window}catch(t){return!1}}()){const t=document.head.querySelector('meta[property="cq:wcmmode"]');if(t&&t.content){return t.content}return f.DISABLED}return!1}!function(t){t.EDIT="edit",t.PREVIEW="preview",t.DISABLED="disabled"}(f||(f={}));var P={isInEditor(){const t=g();return t&&(f.EDIT===t||f.PREVIEW===t)},modelToProps(t){const e=Object.getOwnPropertyNames(t),n={};return e.forEach(e=>{let r=e;if(r.startsWith(":")){const t=r.substr(1);r="cq"+t.substr(0,1).toUpperCase()+t.substr(1)}n[r]=t[e]}),n}};class C extends r.Component{constructor(t){super(t),this.getCQPath=this.getCQPath.bind(this),this.updateData=this.updateData.bind(this),this.state=this.propsToState(t)}propsToState(t){const{wrappedComponent:e,cqForceReload:n,injectPropsOnInit:r,...o}=t;return o}componentDidUpdate(t){i()(t,this.props)||this.setState(this.propsToState(this.props))}updateData(t){const e=t||this.props.cqPath;p.ModelManager.getData({path:e,forceReload:this.props.cqForceReload}).then(t=>{this.setState(P.modelToProps(t))})}getCQPath(){const{pagePath:t="",itemPath:e="",injectPropsOnInit:n}=this.props;let{cqPath:r}=this.props;return n&&!r&&(r=e?`${t}/jcr:content/${e}`:t,r=Object(d.normalize)(r),this.setState({cqPath:r})),r}componentDidMount(){const t=this.getCQPath();this.props.injectPropsOnInit&&this.updateData(t),p.ModelManager.addListener(t,this.updateData)}componentWillUnmount(){p.ModelManager.removeListener(this.props.cqPath,this.updateData)}render(){const t=this.props.wrappedComponent;return o.a.createElement(t,Object.assign({},this.state))}}const E=(t,e)=>class extends r.Component{render(){const n=e||{},r=this.props.cqForceReload||n.forceReload||!1,s=n.injectPropsOnInit||!1;return o.a.createElement(C,Object.assign({},this.props,{cqForceReload:r,injectPropsOnInit:s,wrappedComponent:t}))}},y=o.a.createContext(P.isInEditor()),b=t=>e=>o.a.createElement(y.Consumer,null,n=>o.a.createElement(t,Object.assign({},e,{isInEditor:n}))),T=s.ComponentMapping.map,v=s.ComponentMapping.get;s.ComponentMapping.map=function(t,e,n,r){const o=r||{forceReload:!1};let a=e;return a=b(E(m(a,n),o)),T.call(s.ComponentMapping,t,a),a},s.ComponentMapping.get=v;const q=t=>(e,n)=>s.ComponentMapping.map(t,e,n),O=o.a.createContext(s.ComponentMapping);function I(t){return function(e){return o.a.createElement(O.Consumer,null,n=>o.a.createElement(t,Object.assign({},e,{componentMapping:n})))}}var w=n(1),A=n.n(w);class j extends r.Component{static get propTypes(){return{cqPath:A.a.string,placeholderClassNames:A.a.string}}constructor(t){super(t)}render(){return o.a.createElement("div",{"data-cq-data-path":this.props.cqPath+"/*",className:this.props.placeholderClassNames})}}const _=l.NEW_SECTION_CLASS_NAMES;class M extends r.Component{constructor(t){super(t),this.state={componentMapping:this.props.componentMapping||s.ComponentMapping}}get childComponents(){const t=[];return this.props.cqItems&&this.props.cqItemsOrder?(this.props.cqItemsOrder.map(e=>{const n=P.modelToProps(this.props.cqItems[e]);if(n){const r=this.state.componentMapping.get(n.cqType);r&&t.push(this.connectComponentWithItem(r,n,e))}}),t):t}connectComponentWithItem(t,e,n){const r=this.getItemPath(n);return o.a.createElement(t,Object.assign({},e,{key:r,cqPath:r,isInEditor:this.props.isInEditor,containerProps:this.getItemComponentProps(e,n,r)}))}getItemComponentProps(t,e,n){return{}}getItemPath(t){return this.props&&this.props.cqPath?this.props.cqPath+"/"+t:t}get containerProps(){const t={className:"aem-container"};return this.props.isInEditor&&(t[l.DATA_PATH_ATTR]=this.props.cqPath),t}get placeholderProps(){return{cqPath:this.props.cqPath,placeholderClassNames:_}}get placeholderComponent(){return this.props.isInEditor?o.a.createElement(j,Object.assign({},this.placeholderProps)):null}render(){return o.a.createElement("div",Object.assign({},this.containerProps),this.childComponents,this.placeholderComponent)}}M.defaultProps={cqItems:{},cqItemsOrder:[],cqPath:""};class R extends r.Component{static get propTypes(){return{emptyLabel:A.a.string,path:A.a.string}}render(){const{path:t,emptyLabel:e}=this.props;return o.a.createElement("div",{"data-cq-data-path":t,"data-emptytext":e,className:"aem-AllowedComponent--component cq-placeholder placeholder"})}}class x extends r.Component{static get propTypes(){return{components:A.a.arrayOf(A.a.shape({path:A.a.string,title:A.a.string})),cqPath:A.a.string,emptyLabel:A.a.string,placeholderClassNames:A.a.string,title:A.a.string}}render(){const{components:t,placeholderProps:e,title:n,emptyLabel:r}=this.props,s=t&&t.length>0?n:r;return o.a.createElement("div",{className:"aem-AllowedComponent--list "+e.placeholderClassNames},o.a.createElement("div",{"data-text":s,className:"aem-AllowedComponent--title"}),t.map((t,e)=>o.a.createElement(R,{key:e,path:t.path,emptyLabel:t.title})))}}class N extends M{render(){const{allowedComponents:t,_allowedComponentPlaceholderListEmptyLabel:e,title:n,isInEditor:r}=this.props;if(r&&t&&t.applicable){const r=e||N.defaultProps._allowedComponentPlaceholderListEmptyLabel;if(e)return o.a.createElement(x,{title:n,emptyLabel:r,components:t.components,placeholderProps:this.placeholderProps,cqPath:this.props.cqPath})}return super.render()}}N.defaultProps={_allowedComponentPlaceholderListEmptyLabel:"No allowed components",cqItems:{},cqItemsOrder:[],cqPath:""};class S extends M{constructor(t){super(t),this.state={componentMapping:this.props.componentMapping||s.ComponentMapping}}get containerProps(){const t={className:"aem-page"};return this.props.isInEditor?(t[l.DATA_PATH_ATTR]=this.props.cqPath,t):t}get childPages(){const t=[];return this.props.cqChildren?(Object.keys(this.props.cqChildren).map(e=>{const n=P.modelToProps(this.props.cqChildren[e]),r=this.state.componentMapping.get(n.cqType);r&&t.push(o.a.createElement(r,Object.assign({key:n.cqPath},n,{cqPath:n.cqPath})))}),t):t}getItemPath(t){return this.props&&this.props.cqPath?this.props.cqPath+"/jcr:content/"+t:t}render(){return o.a.createElement("div",Object.assign({},this.containerProps),this.childComponents,this.childPages)}}S.defaultProps={cqChildren:{},cqItems:{},cqItemsOrder:[],cqPath:""};class L extends N{get containerProps(){const t=super.containerProps;return t.className=(t.className||"")+" "+this.props.gridClassNames,t}get placeholderProps(){const t=super.placeholderProps;return t.placeholderClassNames=(t.placeholderClassNames||"")+" aem-Grid-newComponent",t}getItemComponentProps(t,e,n){const r=super.getItemComponentProps(t,e,n);return r.className=r.className||"",r.className+=this.props.columnClassNames&&this.props.columnClassNames[e]?" "+this.props.columnClassNames[e]:"",r}}L.defaultProps={_allowedComponentPlaceholderListEmptyLabel:"No allowed components for Layout Container",cqItems:{},cqItemsOrder:[],cqPath:"",title:"Layout Container"};const D={isEmpty:t=>t.cqItemsOrder&&t.cqItemsOrder.length>0};q("wcm/foundation/components/responsivegrid")(I(L),D)}])}));
//# sourceMappingURL=aem-react-editable-components.js.map